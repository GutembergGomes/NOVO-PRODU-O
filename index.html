<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGOMES-LOG v8.0 - Sistema APRIMORADO: Déficit + Relatórios Completos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            light: '#6EE7B7',
                            dark: '#047857'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            light: '#FCD34D',
                            dark: '#D97706'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            light: '#FCA5A5',
                            dark: '#DC2626'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'slide-down': 'slideDown 0.4s ease-out',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-in-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'shimmer': 'shimmer 2s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(15px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(93, 92, 222, 0.5)' },
                            '100%': { boxShadow: '0 0 20px rgba(93, 92, 222, 0.8)' }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: rgba(156, 163, 175, 0.4); 
            border-radius: 6px; 
            transition: all 0.3s ease;
        }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.7); }
        .dark ::-webkit-scrollbar-thumb { background: rgba(75, 85, 99, 0.6); }
        .dark ::-webkit-scrollbar-thumb:hover { background: rgba(75, 85, 99, 0.8); }

        .loading-dots::after {
            content: '';
            animation: loading-dots 1.5s infinite;
        }
        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .dark .glass {
            background: rgba(17, 24, 39, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .interactive {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .interactive:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        .dark .interactive:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        .nav-link {
            @apply flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 group relative overflow-hidden;
        }
        
        .nav-link.active {
            @apply bg-gradient-to-r from-primary to-primary-600 text-white shadow-lg;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .tooltip {
            position: relative;
        }
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            pointer-events: none;
        }
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }

        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.3);
            border-color: #5D5CDE;
        }

        .data-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .dark .data-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(75,85,99,0.3);
        }
        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #5D5CDE, #10B981, #F59E0B);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-success { background-color: #10B981; }
        .status-warning { background-color: #F59E0B; }
        .status-danger { background-color: #EF4444; }
        .status-info { background-color: #3B82F6; }

        .efficiency-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #e5e7eb;
            position: relative;
        }
        .dark .efficiency-bar {
            background: #374151;
        }

        .efficiency-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .floating-action {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 40;
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 25px rgba(93, 92, 222, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: float 3s ease-in-out infinite;
        }
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(93, 92, 222, 0.4);
        }

        .time-tab-btn {
            transition: all 0.3s ease;
        }
        .time-tab-btn.active {
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            color: white;
            box-shadow: 0 4px 15px rgba(93, 92, 222, 0.3);
        }

        .input-success { 
            border-color: #10B981 !important; 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
        }
        .input-warning { 
            border-color: #F59E0B !important; 
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1) !important;
        }
        .input-error { 
            border-color: #EF4444 !important; 
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        .table-row:hover {
            background: rgba(93, 92, 222, 0.08);
            transform: scale(1.01);
        }
        .dark .table-row:hover {
            background: rgba(93, 92, 222, 0.15);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #EF4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .sidebar-transition {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-result:hover {
            background: rgba(93, 92, 222, 0.1);
            transform: translateX(4px);
        }
        .dark .search-result:hover {
            background: rgba(93, 92, 222, 0.2);
        }

        .data-input {
            transition: all 0.3s ease;
        }

        .data-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }
        .page-content { display: block; }
        .page-content.hidden { display: none; }

        .period-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .time-period-card {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(93, 92, 222, 0.2);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark .time-period-card {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(93, 92, 222, 0.4);
        }

        .time-period-card:hover {
            border-color: #5D5CDE;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.2);
        }

        .time-period-card.active {
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            color: white;
            border-color: #5D5CDE;
            box-shadow: 0 6px 20px rgba(93, 92, 222, 0.4);
        }

        .live-data {
            position: relative;
        }

        .live-data::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px);
        }

        .config-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.2);
        }
        .dark .config-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }

        .tab-button {
            @apply px-4 py-2 text-sm font-medium rounded-lg transition-all duration-300;
        }
        .tab-button.active {
            @apply bg-primary text-white shadow-lg;
        }
        .tab-button:not(.active) {
            @apply bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600;
        }

        .quick-actions-menu {
            animation: slideUpAndFade 0.3s ease-out;
        }

        @keyframes slideUpAndFade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Dark Mode Support */
        .dark {
            color-scheme: dark;
        }

        .dark .glass {
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.4);
        }

        .dark .data-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(75,85,99,0.4);
        }

        .dark .time-period-card {
            background: rgba(31, 41, 55, 0.9);
            color: #E5E7EB;
        }

        .dark .config-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(75,85,99,0.4);
        }

        /* Report specific styles */
        .report-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.95) 100%);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(93, 92, 222, 0.2);
            transition: all 0.3s ease;
        }
        .dark .report-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(93, 92, 222, 0.15);
            border-color: rgba(93, 92, 222, 0.4);
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        /* Print styles */
        @media print {
            .sidebar, .floating-action, .no-print {
                display: none !important;
            }
            .main-content {
                margin-left: 0 !important;
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .floating-action {
                width: 48px;
                height: 48px;
                bottom: 16px;
                right: 16px;
            }
            
            .period-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .report-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Enhanced Loading Screen -->
    <div id="app-loader" class="fixed inset-0 bg-gradient-to-br from-white via-gray-50 to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="relative mb-8">
                <div class="w-24 h-24 border-4 border-primary/20 rounded-full"></div>
                <div class="w-24 h-24 border-4 border-primary border-t-transparent rounded-full animate-spin absolute top-0"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-8 h-8 bg-primary rounded-full animate-pulse"></div>
                </div>
            </div>
            <div class="text-3xl font-bold text-gray-700 dark:text-gray-300 mb-2">
                GGOMES-LOG <span class="text-primary animate-pulse">v8.0</span>
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                Sistema APRIMORADO: Déficit + Relatórios Completos
            </div>
            <div class="flex items-center justify-center space-x-1 mb-4">
                <span class="text-sm text-gray-600 dark:text-gray-400">Inicializando</span>
                <span class="loading-dots text-primary"></span>
            </div>
            <div class="w-80 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                <div id="loading-progress" class="bg-gradient-to-r from-primary via-primary-500 to-primary-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                <span id="loading-status">Carregando componentes...</span>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container relative">
        <!-- Enhanced Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-72 glass shadow-2xl transform -translate-x-full sidebar-transition z-40 border-r border-gray-200/50 dark:border-gray-700/50">
            <div class="flex flex-col h-full">
                <!-- Enhanced Header -->
                <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-primary via-primary-500 to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg transform transition-transform hover:scale-105 hover:rotate-6">
                                GG
                            </div>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-white dark:border-gray-800 animate-pulse"></div>
                        </div>
                        <div>
                            <h1 class="font-bold text-xl text-gray-900 dark:text-white">GGOMES-LOG</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                                <span class="status-indicator status-success"></span>
                                v8.0 APRIMORADO
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Navigation -->
                <nav class="flex-1 px-4 py-6 space-y-3 overflow-y-auto">
                    <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-4 mb-4">
                        Menu Principal
                    </div>
                    
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span>Dashboard</span>
                        <div class="ml-auto">
                            <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="entrega-hora">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Entrega 24h</span>
                        <div class="ml-auto text-xs bg-primary/20 text-primary px-2 py-1 rounded-full">
                            <span id="active-entries-count">4</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="frentes-config">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span>Config. Frentes</span>
                        <div class="ml-auto">
                            <span class="text-xs text-warning font-medium animate-pulse">UPD</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="analytics">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span>Analytics Avançado</span>
                        <div class="ml-auto">
                            <span class="text-xs text-success font-medium animate-pulse">PRO</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="metas">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Metas e KPIs</span>
                        <div class="ml-auto">
                            <div class="w-2 h-2 bg-warning rounded-full animate-pulse"></div>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="historico">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>Histórico</span>
                    </a>

                    <a href="#" class="nav-link" data-page="relatorios">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span>Relatórios</span>
                        <div class="ml-auto">
                            <span class="text-xs text-success font-medium animate-pulse">NEW</span>
                        </div>
                    </a>

                    <div class="pt-6 mt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                        <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-4 mb-4">
                            Sistema
                        </div>
                        
                        <a href="#" class="nav-link" data-page="backup">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                            </svg>
                            <span>Backup & Sync</span>
                            <div class="ml-auto">
                                <div id="sync-status" class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-link" data-page="configuracoes">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span>Configurações</span>
                        </a>
                    </div>
                </nav>

                <!-- Enhanced User Profile -->
                <div class="p-4 border-t border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center space-x-3 p-4 rounded-xl glass hover:bg-white/20 dark:hover:bg-gray-700/20 transition-all duration-300 cursor-pointer group">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 via-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold shadow-lg group-hover:scale-105 transition-transform">
                                GG
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-white dark:border-gray-800 animate-pulse"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-gray-900 dark:text-white truncate">Gutemberg Gomes</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 truncate">Gerente de Operações</p>
                            <div class="flex items-center mt-1">
                                <div class="w-2 h-2 bg-success rounded-full mr-2 animate-pulse"></div>
                                <span class="text-xs text-success">Online</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden transition-all duration-300"></div>

        <!-- Main Content Area -->
        <div class="main-content transition-all duration-500 ease-in-out">
            <!-- Enhanced Header -->
            <header class="sticky top-0 z-20 glass border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <!-- Left Section -->
                        <div class="flex items-center space-x-4">
                            <button id="sidebar-toggle" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 focus:outline-none focus-ring transition-all duration-300">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                            </button>

                            <!-- Enhanced Date Navigation -->
                            <div class="flex items-center space-x-2 glass rounded-xl p-2">
                                <button id="prev-date" class="p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-600/50 transition-all duration-300 tooltip" data-tooltip="Dia anterior (Alt + ←)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                    </svg>
                                </button>
                                
                                <button id="date-picker" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-gray-600/50 rounded-lg transition-all duration-300">
                                    <span id="current-date-display" class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <span id="date-text">Hoje</span>
                                    </span>
                                </button>
                                
                                <button id="next-date" class="p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-600/50 transition-all duration-300 tooltip" data-tooltip="Próximo dia (Alt + →)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Live Status Indicators -->
                            <div class="hidden lg:flex items-center space-x-4">
                                <div class="flex items-center space-x-2 text-sm">
                                    <div class="status-indicator status-success"></div>
                                    <span class="text-gray-600 dark:text-gray-400">Sistema Online</span>
                                </div>
                                <div class="flex items-center space-x-2 text-sm">
                                    <div id="auto-save-indicator" class="status-indicator status-info"></div>
                                    <span class="text-gray-600 dark:text-gray-400">Auto-save Ativo</span>
                                </div>
                                <div class="flex items-center space-x-2 text-sm live-data">
                                    <div class="status-indicator status-success"></div>
                                    <span class="text-gray-600 dark:text-gray-400">APRIMORADO v8.0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Section -->
                        <div class="flex items-center space-x-3">
                            <!-- Quick Stats -->
                            <div class="hidden xl:flex items-center space-x-4 text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-total-delivered">0</span>t entregue
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-danger rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-missing">0</span>t faltante
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-efficiency">0</span>% eficiência
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-trucks-hour">0</span> cam/h TOTAL
                                    </span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex items-center space-x-2">
                                <!-- Search -->
                                <button id="search-trigger" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip relative" data-tooltip="Busca rápida (Ctrl + K)">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </button>

                                <!-- Notifications -->
                                <button id="notifications-trigger" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip relative" data-tooltip="Notificações">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                    </svg>
                                    <div id="notification-badge" class="notification-badge">0</div>
                                </button>

                                <!-- Theme Toggle -->
                                <button id="theme-toggle" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip" data-tooltip="Alternar tema (Ctrl + D)">
                                    <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                    <svg id="moon-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                                    </svg>
                                </button>

                                <!-- Save Button -->
                                <button id="save-data" class="p-2 rounded-xl bg-gradient-to-r from-primary to-primary-600 text-white hover:from-primary-600 hover:to-primary-700 transition-all duration-300 tooltip shadow-lg hover:shadow-xl transform hover:scale-105" data-tooltip="Salvar dados (Ctrl + S)">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dynamic Content Area -->
            <main class="flex-1 p-6 overflow-auto">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="page-content">
                    <!-- Quick Actions Bar -->
                    <div class="mb-6 glass rounded-xl p-4">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div class="flex items-center space-x-4">
                                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Dashboard Principal - APRIMORADO v8.0</h2>
                                <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                                    <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                                    <span>Déficit por Frente + Relatórios Completos + Média TOTAL Cam/Hora</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="refresh-dashboard" class="flex items-center px-3 py-2 text-sm font-medium bg-white/50 dark:bg-gray-700/50 hover:bg-white dark:hover:bg-gray-600 rounded-lg transition-all duration-300 group">
                                    <svg class="w-4 h-4 mr-2 group-hover:animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    Atualizar
                                </button>
                                <button id="export-dashboard" class="flex items-center px-3 py-2 text-sm font-medium bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-all duration-300">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Stats Cards with Missing Delivery -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-6 mb-8">
                        <!-- Total Delivered Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total Entregue (24h)</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="total-delivered">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-primary mr-2" id="delivery-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">vs meta</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-float">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-success rounded-full flex items-center justify-center animate-bounce" id="delivery-status">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Meta Todas Frentes</span>
                                    <span class="font-medium" id="delivery-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: 0%" id="delivery-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- NEW: Missing Delivery Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Não Entregue</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="total-missing">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-danger mr-2" id="missing-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">faltante</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                        </svg>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-warning rounded-full flex items-center justify-center animate-pulse" id="missing-status">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Déficit Total</span>
                                    <span class="font-medium text-danger" id="missing-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-red-500 to-red-600" style="width: 0%" id="missing-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Efficiency Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Eficiência Real</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="overall-efficiency">0%</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="efficiency-trend">Só horas c/ dados</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">vs potencial</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                        <path class="text-gray-300 dark:text-gray-600" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                        <path id="efficiency-circle" class="text-green-500" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-500 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Horas Com Dados</span>
                                    <span class="font-medium" id="efficiency-status">Calculando</span>
                                </div>
                            </div>
                        </div>

                        <!-- Trips Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total de Viagens</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="total-trips">0</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="trips-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">vs meta</span>
                                    </div>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-bounce">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Meta Estimada</span>
                                    <span class="font-medium" id="trips-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-purple-500 to-purple-600" style="width: 0%" id="trips-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- CORRECTED: Average Trucks per Hour Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total Caminhões/Hora</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="avg-trucks-hour">0.0</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="trucks-trend">TOTAL todas frentes</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">por hora ativa</span>
                                    </div>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Períodos Ativos</span>
                                    <span class="font-medium" id="active-periods-count">0</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-orange-500 to-orange-600" style="width: 0%" id="trucks-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Potential vs Real Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Potencial Usado</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="total-potential">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="potential-trend">Só horas ativas</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">configurado</span>
                                    </div>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Aproveitamento</span>
                                    <span class="font-medium" id="potential-usage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-green-500 to-green-600" style="width: 0%" id="potential-progress"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Charts Section -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                        <!-- Main Performance Chart -->
                        <div class="xl:col-span-2 glass rounded-2xl p-6 shadow-xl">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Performance vs Potencial (Só Horas com Dados)</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Cálculo corrigido - apenas horas preenchidas</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                                        <button class="chart-period-btn active px-3 py-2 text-xs font-medium rounded-md bg-primary text-white transition-all duration-300" data-period="day">Hoje</button>
                                        <button class="chart-period-btn px-3 py-2 text-xs font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-period="week">7 Dias</button>
                                        <button class="chart-period-btn px-3 py-2 text-xs font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-period="month">30 Dias</button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container relative">
                                <canvas id="performance-chart"></canvas>
                                <div id="chart-loading" class="absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-800/80 rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Atualizando dados...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Front Efficiency Chart -->
                        <div class="glass rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência por Frente</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Performance real vs potencial</p>
                                </div>
                                <button class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="front-efficiency-chart"></canvas>
                            </div>
                            <div class="mt-4 space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Melhor performance</span>
                                    <span class="font-semibold text-success animate-pulse" id="best-front">Calculando...</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Precisa atenção</span>
                                    <span class="font-semibold text-warning animate-pulse" id="attention-front">Calculando...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Performance Table with Missing Delivery Column -->
                    <div class="glass rounded-2xl shadow-xl overflow-hidden">
                        <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Detalhamento por Frente - APRIMORADO v8.0</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Inclui cálculo de déficit + eficiência corrigida + Total Caminhões/Hora</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="table-search" placeholder="Buscar frente..." class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus-ring text-base">
                                    </div>
                                    <button id="table-export" class="flex items-center px-3 py-2 text-sm font-medium bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-all duration-300">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200/50 dark:divide-gray-700/50">
                                <thead class="bg-gray-50/50 dark:bg-gray-700/50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-100 transition-colors" data-sort="front">
                                            <div class="flex items-center space-x-1">
                                                <span>Frente</span>
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                </svg>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entregue (24h)</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-danger uppercase tracking-wider">Não Entregue</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial Usado</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Meta Diária</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência Real</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cam/Hora</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-table" class="bg-white/50 dark:bg-gray-800/50 divide-y divide-gray-200/50 dark:divide-gray-700/50">
                                    <!-- Real data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200/50 dark:border-gray-700/50 bg-gray-50/50 dark:bg-gray-700/50">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    Mostrando <span id="table-showing">0-0</span> de <span id="table-total">0</span> frentes
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Anterior
                                    </button>
                                    <span class="px-3 py-1 text-sm bg-primary text-white rounded-md">1</span>
                                    <button class="px-3 py-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Próximo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuração de Frentes Content -->
                <div id="frentes-config-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Configuração de Frentes</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Configure potencial por hora e metas diárias para cada frente</p>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="add-new-front-config" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                    Nova Frente
                                </button>
                                <button id="import-config" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                                    </svg>
                                    Importar Configuração
                                </button>
                                <button id="export-config" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0L8 8m4-4v12"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Cards Grid -->
                    <div id="fronts-config-grid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Configuration cards will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Entrega por Hora Content -->
                <div id="entrega-hora-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Controle de Entrega 24h (06:00-06:00)</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Gerencie todas as entregas em períodos de 2 horas durante 24 horas completas</p>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="manage-fronts" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                    Limpar Período
                                </button>
                                <button id="export-period" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0L8 8m4-4v12"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Period Selection -->
                    <div class="mb-6">
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Períodos do Dia - Ciclo Completo 24h</h3>
                                <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                                    <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                                    <span>Auto-save ativo</span>
                                </div>
                            </div>
                            <div class="period-grid" id="time-periods-container">
                                <!-- Time period cards will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Time Period Content Container -->
                    <div id="time-period-content" class="animate-fade-in">
                        <!-- Active Period Form -->
                        <div class="glass rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white" id="period-title">Período: 06:00-08:00</h3>
                                <div class="flex items-center space-x-4 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full animate-pulse"></div>
                                        <span class="text-gray-600 dark:text-gray-400">Total Viagens: <span class="font-bold" id="period-total-trips">0</span></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
                                        <span class="text-gray-600 dark:text-gray-400">Total Entrega: <span class="font-bold" id="period-total-delivery">0.0t</span></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                                        <span class="text-gray-600 dark:text-gray-400">Potencial: <span class="font-bold" id="period-total-potential">0.0t</span></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Input Table -->
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead class="bg-gray-50/50 dark:bg-gray-800/50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="hour1-header">06:00</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="hour2-header">07:00</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Período</th>
                                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência vs Potencial</th>
                                        </tr>
                                    </thead>
                                    <tbody id="period-data-table" class="bg-white/50 dark:bg-gray-800/50 divide-y divide-gray-200/50 dark:divide-gray-700/50">
                                        <!-- Dynamic content will be generated here -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Period Summary -->
                            <div class="mt-6 p-4 bg-gradient-to-r from-primary/10 to-primary-600/10 rounded-xl border border-primary/20">
                                <h4 class="text-lg font-bold text-primary mb-3" id="period-summary-title">Resumo do Período 06:00-08:00</h4>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="summary-delivered">0.0t</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Total Entregue</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="summary-trips">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Total Viagens</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="summary-efficiency">0%</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Eficiência vs Potencial</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-gray-900 dark:text-white" id="summary-potential">0.0t</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Potencial Configurado</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: Complete Reports Section -->
                <div id="relatorios-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Central de Relatórios</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Relatórios completos com análises detalhadas e exportação</p>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="generate-all-reports" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                    </svg>
                                    Gerar Todos
                                </button>
                                <button id="schedule-reports" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Programar
                                </button>
                                <button id="export-reports-config" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    Configurações
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Report Types Grid -->
                    <div class="report-grid mb-8">
                        <!-- Daily Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="daily">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full font-medium">DIÁRIO</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório Diário</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise completa do dia com entregas, déficit, eficiência e comparativos</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Última geração:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="daily-last-gen">Nunca</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Formato:</span>
                                    <span class="font-medium text-gray-900 dark:text-white">PDF + CSV</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="daily">
                                Gerar Relatório Diário
                            </button>
                        </div>

                        <!-- Weekly Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="weekly">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400 px-2 py-1 rounded-full font-medium">SEMANAL</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório Semanal</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Tendências semanais, comparativos e análise de performance por frente</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Última geração:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="weekly-last-gen">Nunca</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Período:</span>
                                    <span class="font-medium text-gray-900 dark:text-white">7 dias</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="weekly">
                                Gerar Relatório Semanal
                            </button>
                        </div>

                        <!-- Monthly Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="monthly">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-purple-100 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 px-2 py-1 rounded-full font-medium">MENSAL</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório Mensal</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise consolidada mensal com KPIs, metas alcançadas e recomendações</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Última geração:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="monthly-last-gen">Nunca</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Período:</span>
                                    <span class="font-medium text-gray-900 dark:text-white">30 dias</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="monthly">
                                Gerar Relatório Mensal
                            </button>
                        </div>

                        <!-- Performance Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="performance">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 px-2 py-1 rounded-full font-medium">PERFORMANCE</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Análise de Performance</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Ranking de frentes, eficiências, déficit por frente e benchmarks</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Inclui déficit:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Benchmarks:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="performance">
                                Gerar Análise de Performance
                            </button>
                        </div>

                        <!-- Efficiency Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="efficiency">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-2 py-1 rounded-full font-medium">DÉFICIT</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório de Déficit</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise detalhada do que não foi entregue por frente e período</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Por frente:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Por período:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="efficiency">
                                Gerar Relatório de Déficit
                            </button>
                        </div>

                        <!-- Custom Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="custom">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-gray-100 dark:bg-gray-900/20 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full font-medium">CUSTOMIZADO</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório Customizado</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Configure seu próprio relatório com filtros e métricas específicas</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Filtros:</span>
                                    <span class="font-medium text-primary">Configurável</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Período:</span>
                                    <span class="font-medium text-primary">Livre</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="custom">
                                Configurar Relatório
                            </button>
                        </div>
                    </div>

                    <!-- Recent Reports Section -->
                    <div class="glass rounded-2xl p-6 shadow-xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Relatórios Recentes</h3>
                            <button id="clear-reports-history" class="text-sm text-gray-500 hover:text-red-500 transition-colors">
                                Limpar Histórico
                            </button>
                        </div>
                        <div id="recent-reports-list" class="space-y-3">
                            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <p>Nenhum relatório gerado ainda</p>
                                <p class="text-xs mt-2">Gere seu primeiro relatório usando os cartões acima</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other content sections remain the same but are hidden for brevity -->
                <div id="analytics-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Analytics Avançado</h2>
                        <p class="text-gray-600 dark:text-gray-400">Seção em desenvolvimento com a nova lógica de cálculo v8.0</p>
                    </div>
                </div>

                <div id="metas-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Metas e KPIs</h2>
                        <p class="text-gray-600 dark:text-gray-400">Seção em desenvolvimento com eficiência corrigida v8.0</p>
                    </div>
                </div>

                <div id="historico-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Histórico</h2>
                        <p class="text-gray-600 dark:text-gray-400">Histórico será implementado em breve - salvamento por data v8.0</p>
                    </div>
                </div>

                <div id="backup-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Backup & Sincronização</h2>
                        <p class="text-gray-600 dark:text-gray-400">Backup será implementado em breve</p>
                    </div>
                </div>

                <div id="configuracoes-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Configurações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Configurações serão implementadas em breve</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Enhanced Toast Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 space-y-3 max-w-sm"></div>

    <!-- Enhanced Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden">
        <div class="flex items-start justify-center min-h-screen pt-20 px-4">
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" id="search-backdrop"></div>
            <div class="relative glass rounded-2xl shadow-2xl w-full max-w-2xl border border-white/20 dark:border-gray-700/20">
                <div class="p-6">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        <input type="text" id="search-input" class="flex-1 text-lg bg-transparent border-none outline-none text-gray-900 dark:text-white placeholder-gray-500 text-base" placeholder="Buscar frentes, períodos, configurações..." autofocus>
                        <button id="close-search" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <div id="search-results" class="space-y-2 max-h-96 overflow-y-auto">
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <p>Digite para pesquisar...</p>
                            <p class="text-xs mt-2">Use Ctrl+K para busca rápida</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="fronts-modal-backdrop"></div>
        <div class="glass rounded-2xl p-8 max-w-lg w-full relative z-10 shadow-2xl border border-white/20 dark:border-gray-700/20 mx-4">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Adicione ou remova frentes de trabalho</p>
                </div>
                <button id="close-fronts-modal" class="p-2 text-gray-400 hover:text-gray-500 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="flex gap-3 mb-4">
                    <input type="text" id="new-front-input" placeholder="Ex: 4010" class="flex-1 px-4 py-3 text-base text-gray-700 dark:text-gray-300 bg-white/50 dark:bg-gray-700/50 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:border-primary transition-all">
                    <button id="add-front-btn" class="px-6 py-3 bg-gradient-to-r from-primary to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-medium">
                        Adicionar
                    </button>
                </div>
            </div>
            
            <div class="glass rounded-xl overflow-hidden border border-gray-200/50 dark:border-gray-700/50">
                <div class="bg-gray-50/50 dark:bg-gray-700/50 px-4 py-3 border-b border-gray-200/50 dark:border-gray-700/50">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Frentes Atuais</h4>
                </div>
                <ul id="fronts-list" class="divide-y divide-gray-200/50 dark:divide-gray-700/50 max-h-60 overflow-y-auto">
                    <!-- Current fronts will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Front Configuration Modal -->
    <div id="front-config-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="config-modal-backdrop"></div>
        <div class="glass rounded-2xl p-8 max-w-4xl w-full relative z-10 shadow-2xl border border-white/20 dark:border-gray-700/20 mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="config-modal-title">Configurar Frente</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Configure potencial por hora e meta diária</p>
                </div>
                <button id="close-config-modal" class="p-2 text-gray-400 hover:text-gray-500 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Configuration Tabs -->
            <div class="flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                <button class="tab-button active" data-tab="general">Configuração Geral</button>
                <button class="tab-button" data-tab="potential">Potencial por Hora</button>
            </div>

            <!-- General Tab -->
            <div id="general-tab" class="tab-content">
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Meta Diária (toneladas)</label>
                            <input type="number" id="front-daily-goal" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="1000" min="0" step="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Potencial Padrão por Hora (toneladas)</label>
                            <input type="number" id="front-default-potential" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="50" min="0" step="0.1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                        <textarea id="front-notes" rows="3" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="Observações sobre a frente..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Potential Tab -->
            <div id="potential-tab" class="tab-content hidden">
                <div class="space-y-4">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Potencial por Hora (24h)</h4>
                        <button id="copy-default-potential" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg transition-colors">
                            Aplicar Padrão para Todas
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3" id="hourly-potential-grid">
                        <!-- Hourly potential inputs will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                <button id="cancel-config" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl transition-all duration-300 font-medium">
                    Cancelar
                </button>
                <button id="save-config" class="px-6 py-3 bg-gradient-to-r from-primary to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-medium">
                    Salvar Configuração
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay for operations -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="glass rounded-2xl p-8 text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Processando...</p>
            <p class="text-sm text-gray-600 dark:text-gray-400" id="loading-message">Aguarde um momento</p>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action no-print" id="floating-action" title="Ações rápidas">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
    </div>

    <!-- JavaScript Application -->
    <script>
        class GGomesLogSystemEnhanced {
            constructor() {
                this.version = '8.0';
                this.state = {
                    currentDate: new Date().toISOString().split('T')[0],
                    currentPage: 'dashboard',
                    activePeriod: '06-08',
                    fronts: ['4001', '4002', '4007', '4009'], // Default fronts
                    
                    // Data structures for all periods - REAL DATA
                    data: {
                        periods: {},
                        
                        // Front configurations with potential and goals
                        frontConfigs: {
                            // Structure: frontNumber: { dailyGoal, defaultPotential, hourlyPotential, notes }
                        },
                        
                        // Global goals (calculated from individual front goals)
                        dailyGoals: {
                            delivery: 4000, // Will be sum of all front goals
                            efficiency: 85, // %
                            trips: 1500
                        }
                    },
                    
                    // UI state management
                    ui: {
                        sidebarOpen: false,
                        searchOpen: false,
                        loading: false,
                        unsavedChanges: false,
                        currentConfigFront: null,
                        activeConfigTab: 'general'
                    },
                    
                    // Charts storage
                    charts: {},
                    
                    // NEW: Reports system
                    reports: {
                        history: [],
                        lastGenerated: {},
                        templates: {
                            daily: { name: 'Relatório Diário', format: 'PDF+CSV' },
                            weekly: { name: 'Relatório Semanal', format: 'PDF+Excel' },
                            monthly: { name: 'Relatório Mensal', format: 'PDF+PowerPoint' },
                            performance: { name: 'Análise de Performance', format: 'PDF' },
                            efficiency: { name: 'Relatório de Déficit', format: 'PDF+CSV' },
                            custom: { name: 'Relatório Customizado', format: 'Configurável' }
                        }
                    },
                    
                    // Configuration
                    config: {
                        autoSaveInterval: 30000, // 30 seconds
                        chartUpdateInterval: 5000, // 5 seconds
                        maxEfficiency: 100,
                        defaultDensity: 65,
                        standardTripCapacity: 3.0, // toneladas por viagem - fallback
                        defaultFrontGoal: 1000, // Default goal per front
                        defaultPotentialPerHour: 50, // Default potential per hour
                        efficiencyTarget: 85, // Default efficiency target
                        notifications: {
                            enabled: true,
                            sound: false,
                            efficiencyAlerts: true
                        },
                        theme: 'auto',
                        uiDensity: 'comfortable'
                    }
                };

                // Time slots configuration - COMPLETE 24h CYCLE (06:00-06:00)
                this.timeSlots = [
                    { period: '06-08', start: '06:00', end: '08:00', label: 'Manhã', hours: ['06:00', '07:00'] },
                    { period: '08-10', start: '08:00', end: '10:00', label: 'Manhã', hours: ['08:00', '09:00'] },
                    { period: '10-12', start: '10:00', end: '12:00', label: 'Manhã', hours: ['10:00', '11:00'] },
                    { period: '12-14', start: '12:00', end: '14:00', label: 'Tarde', hours: ['12:00', '13:00'] },
                    { period: '14-16', start: '14:00', end: '16:00', label: 'Tarde', hours: ['14:00', '15:00'] },
                    { period: '16-18', start: '16:00', end: '18:00', label: 'Tarde', hours: ['16:00', '17:00'] },
                    { period: '18-20', start: '18:00', end: '20:00', label: 'Noite', hours: ['18:00', '19:00'] },
                    { period: '20-22', start: '20:00', end: '22:00', label: 'Noite', hours: ['20:00', '21:00'] },
                    { period: '22-00', start: '22:00', end: '00:00', label: 'Noite', hours: ['22:00', '23:00'] },
                    { period: '00-02', start: '00:00', end: '02:00', label: 'Madrugada', hours: ['00:00', '01:00'] },
                    { period: '02-04', start: '02:00', end: '04:00', label: 'Madrugada', hours: ['02:00', '03:00'] },
                    { period: '04-06', start: '04:00', end: '06:00', label: 'Madrugada', hours: ['04:00', '05:00'] }
                ];

                // Hours for potential configuration (24h)
                this.hours24 = [
                    '06:00', '07:00', '08:00', '09:00', '10:00', '11:00',
                    '12:00', '13:00', '14:00', '15:00', '16:00', '17:00',
                    '18:00', '19:00', '20:00', '21:00', '22:00', '23:00',
                    '00:00', '01:00', '02:00', '03:00', '04:00', '05:00'
                ];

                this.charts = {};
                this.isChartsLibraryLoaded = false;
                this.eventListenersAdded = false;
                
                this.init();
            }

            async init() {
                try {
                    console.log(`🚀 Inicializando GGOMES-LOG v${this.version} - APRIMORADO: Déficit + Relatórios Completos...`);
                    
                    this.showLoadingProgress(10, 'Carregando bibliotecas...');
                    await this.waitForLibraries();
                    
                    this.showLoadingProgress(25, 'Configurando tema...');
                    this.setupTheme();
                    
                    this.showLoadingProgress(40, 'Carregando dados APRIMORADOS...');
                    this.loadData(); // Load first to get existing configs
                    
                    this.showLoadingProgress(55, 'Inicializando estrutura de dados 24h...');
                    this.initializeDataStructures();
                    this.initializeFrontConfigs();
                    
                    this.showLoadingProgress(70, 'Configurando interface...');
                    this.initializeUI();
                    
                    this.showLoadingProgress(85, 'Criando gráficos com cores dinâmicas...');
                    await this.initializeCharts();
                    
                    this.showLoadingProgress(90, 'Configurando eventos...');
                    this.setupEventListeners();
                    
                    this.showLoadingProgress(95, 'Finalizando configuração...');
                    this.startPeriodicUpdates();
                    
                    this.showLoadingProgress(100, 'Sistema pronto!');
                    
                    setTimeout(() => {
                        this.hideLoader();
                        this.showToast(`🎉 GGOMES-LOG v${this.version} carregado - APRIMORADO: Déficit + Relatórios Completos!`, 'success');
                        this.updateDateDisplay();
                        this.updateAllRealData(); // Update real data immediately
                    }, 800);
                    
                } catch (error) {
                    console.error('❌ Erro na inicialização:', error);
                    this.showToast('Erro na inicialização do sistema', 'error');
                    this.hideLoader();
                }
            }

            showLoadingProgress(progress, status) {
                const progressBar = document.getElementById('loading-progress');
                const statusText = document.getElementById('loading-status');
                
                if (progressBar) {
                    progressBar.style.width = `${Math.min(progress, 100)}%`;
                }
                if (statusText) {
                    statusText.textContent = status;
                }
            }

            async waitForLibraries() {
                let attempts = 0;
                const maxAttempts = 100;
                
                while (typeof Chart === 'undefined' && attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                    attempts++;
                }
                
                if (typeof Chart !== 'undefined') {
                    this.isChartsLibraryLoaded = true;
                    console.log('✅ Chart.js carregado');
                } else {
                    console.warn('⚠️ Chart.js não foi carregado');
                }
            }

            setupTheme() {
                // Apply system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    document.documentElement.classList.add('dark');
                }
                
                this.updateThemeIcons();
                
                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (this.state.config.theme === 'auto') {
                        if (e.matches) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        this.updateThemeIcons();
                        this.updateChartsTheme();
                    }
                });
            }

            updateThemeIcons() {
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                
                if (sunIcon && moonIcon) {
                    const isDark = document.documentElement.classList.contains('dark');
                    sunIcon.classList.toggle('hidden', !isDark);
                    moonIcon.classList.toggle('hidden', isDark);
                }
            }

            initializeDataStructures() {
                // Initialize data structure for ALL 24h periods and fronts
                this.timeSlots.forEach(slot => {
                    if (!this.state.data.periods[slot.period]) {
                        this.state.data.periods[slot.period] = {
                            fronts: {}
                        };
                    }
                    
                    this.state.fronts.forEach(front => {
                        if (!this.state.data.periods[slot.period].fronts[front]) {
                            this.state.data.periods[slot.period].fronts[front] = {
                                hour1: { density: 0, trips: 0, delivery: 0 },
                                hour2: { density: 0, trips: 0, delivery: 0 },
                                total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                            };
                        }
                    });
                });
                
                console.log('📊 Estrutura de dados 24h inicializada para todas as frentes');
            }

            // Initialize front configurations with potential and goals
            initializeFrontConfigs() {
                this.state.fronts.forEach(front => {
                    if (!this.state.data.frontConfigs[front]) {
                        this.state.data.frontConfigs[front] = {
                            dailyGoal: this.state.config.defaultFrontGoal,
                            defaultPotential: this.state.config.defaultPotentialPerHour,
                            hourlyPotential: {},
                            notes: ''
                        };
                        
                        // Initialize hourly potential for all 24 hours
                        this.hours24.forEach(hour => {
                            this.state.data.frontConfigs[front].hourlyPotential[hour] = this.state.config.defaultPotentialPerHour;
                        });
                    }
                });
                
                this.updateGlobalGoals();
                console.log('⚙️ Configurações de frentes inicializadas');
            }

            updateGlobalGoals() {
                // Calculate total daily goal from all fronts
                let totalGoal = 0;
                this.state.fronts.forEach(front => {
                    const config = this.state.data.frontConfigs[front];
                    if (config && config.dailyGoal) {
                        totalGoal += parseFloat(config.dailyGoal) || 0;
                    }
                });
                this.state.data.dailyGoals.delivery = totalGoal;
                
                console.log(`📊 Meta global atualizada: ${totalGoal}t`);
            }

            // Data Management - Fixed loading and saving with proper date management
            loadData() {
                try {
                    // Always load general configuration first (fronts list and configurations)
                    const generalData = localStorage.getItem('ggomes-log-data-v80-config');
                    if (generalData) {
                        const data = JSON.parse(generalData);
                        
                        if (data.fronts && Array.isArray(data.fronts)) {
                            this.state.fronts = data.fronts;
                        }
                        
                        if (data.data?.frontConfigs) {
                            this.state.data.frontConfigs = data.data.frontConfigs;
                        }
                        
                        if (data.data?.dailyGoals) {
                            this.state.data.dailyGoals = data.data.dailyGoals;
                        }

                        if (data.config) {
                            this.state.config = { ...this.state.config, ...data.config };
                        }

                        // Load reports history
                        if (data.reports) {
                            this.state.reports = { ...this.state.reports, ...data.reports };
                        }
                    }
                    
                    // Then try to load data specific to the current date
                    const dateKey = `ggomes-log-data-v80-${this.state.currentDate}`;
                    const dateData = localStorage.getItem(dateKey);
                    
                    if (dateData) {
                        const data = JSON.parse(dateData);
                        
                        if (data.data?.periods) {
                            this.state.data.periods = data.data.periods;
                        }
                        
                        if (data.activePeriod) {
                            this.state.activePeriod = data.activePeriod;
                        }
                        
                        console.log('✅ Dados carregados para data:', this.state.currentDate);
                    } else {
                        // Initialize empty periods for this date
                        this.timeSlots.forEach(slot => {
                            this.state.data.periods[slot.period] = { fronts: {} };
                        });
                        console.log('📅 Nova data inicializada:', this.state.currentDate);
                    }
                    
                    // Ensure data structure integrity for ALL periods and front configs
                    this.initializeDataStructures();
                    this.initializeFrontConfigs();
                    
                } catch (error) {
                    console.error('❌ Erro ao carregar dados:', error);
                    this.showToast('Erro ao carregar dados salvos. Usando configurações padrão.', 'warning');
                }
            }

            // Save data with proper date and configuration management
            saveData() {
                try {
                    // Always update global goals before saving
                    this.updateGlobalGoals();
                    
                    // Save general configuration (fronts, configurations, global settings, reports)
                    const configData = {
                        version: this.version,
                        timestamp: new Date().toISOString(),
                        fronts: this.state.fronts,
                        data: {
                            frontConfigs: this.state.data.frontConfigs,
                            dailyGoals: this.state.data.dailyGoals
                        },
                        config: this.state.config,
                        reports: this.state.reports
                    };
                    localStorage.setItem('ggomes-log-data-v80-config', JSON.stringify(configData));
                    
                    // Save date-specific data (periods and active period)
                    const dateData = {
                        version: this.version,
                        timestamp: new Date().toISOString(),
                        currentDate: this.state.currentDate,
                        activePeriod: this.state.activePeriod,
                        data: {
                            periods: this.state.data.periods
                        }
                    };
                    const dateKey = `ggomes-log-data-v80-${this.state.currentDate}`;
                    localStorage.setItem(dateKey, JSON.stringify(dateData));
                    
                    this.state.ui.unsavedChanges = false;
                    
                    console.log('💾 Dados salvos para data:', this.state.currentDate);
                    this.showToast(`💾 Dados salvos para ${this.formatDate(this.state.currentDate)}`, 'success');
                    
                    // Update auto-save indicator
                    const indicator = document.getElementById('auto-save-indicator');
                    if (indicator) {
                        indicator.className = 'status-indicator status-success';
                        setTimeout(() => {
                            indicator.className = 'status-indicator status-info';
                        }, 2000);
                    }
                } catch (error) {
                    console.error('❌ Erro ao salvar:', error);
                    this.showToast('Erro ao salvar dados', 'error');
                }
            }

            // FIXED: Dynamic Color Generator
            generateDynamicColors(count) {
                const baseColors = [
                    '#10B981', // Green
                    '#5D5CDE', // Primary Purple
                    '#F59E0B', // Orange
                    '#EF4444', // Red
                    '#3B82F6', // Blue
                    '#8B5CF6', // Violet
                    '#F97316', // Orange-Red
                    '#06B6D4', // Cyan
                    '#84CC16', // Lime
                    '#EC4899', // Pink
                    '#6366F1', // Indigo
                    '#14B8A6', // Teal
                    '#F472B6', // Pink-400
                    '#A855F7', // Purple-500
                    '#22C55E', // Green-500
                    '#EAB308', // Yellow-500
                    '#DC2626', // Red-600
                    '#2563EB', // Blue-600
                ];

                // If we need more colors than base colors, generate additional ones
                if (count <= baseColors.length) {
                    return baseColors.slice(0, count);
                }

                const colors = [...baseColors];
                const hueStep = 360 / count;
                
                // Generate additional colors using HSL
                for (let i = baseColors.length; i < count; i++) {
                    const hue = (i * hueStep) % 360;
                    const saturation = 70 + (i % 3) * 10; // Vary saturation
                    const lightness = 50 + (i % 2) * 10; // Vary lightness
                    colors.push(`hsl(${hue}, ${saturation}%, ${lightness}%)`);
                }

                return colors;
            }

            setupEventListeners() {
                if (this.eventListenersAdded) {
                    console.log('⚠️ Event listeners já foram adicionados');
                    return;
                }

                try {
                    // Core Navigation
                    this.addEventListenerSafe('sidebar-toggle', 'click', () => this.toggleSidebar());
                    this.addEventListenerSafe('sidebar-overlay', 'click', () => this.toggleSidebar(false));
                    
                    // Header Actions
                    this.addEventListenerSafe('theme-toggle', 'click', () => this.toggleTheme());
                    this.addEventListenerSafe('save-data', 'click', () => this.saveData());
                    this.addEventListenerSafe('search-trigger', 'click', () => this.showSearch());
                    this.addEventListenerSafe('close-search', 'click', () => this.hideSearch());
                    this.addEventListenerSafe('search-backdrop', 'click', () => this.hideSearch());
                    this.addEventListenerSafe('floating-action', 'click', () => this.showQuickActions());
                    this.addEventListenerSafe('notifications-trigger', 'click', () => this.showNotifications());

                    // Date Navigation
                    this.addEventListenerSafe('prev-date', 'click', () => this.navigateDate(-1));
                    this.addEventListenerSafe('next-date', 'click', () => this.navigateDate(1));
                    this.addEventListenerSafe('date-picker', 'click', () => this.showDatePicker());

                    // Dashboard Actions
                    this.addEventListenerSafe('refresh-dashboard', 'click', () => this.refreshDashboard());
                    this.addEventListenerSafe('export-dashboard', 'click', () => this.exportDashboard());
                    this.addEventListenerSafe('table-export', 'click', () => this.exportTable());

                    // Entrega por Hora Actions
                    this.addEventListenerSafe('manage-fronts', 'click', () => this.showManageFrontsModal());
                    this.addEventListenerSafe('close-fronts-modal', 'click', () => this.hideManageFrontsModal());
                    this.addEventListenerSafe('fronts-modal-backdrop', 'click', () => this.hideManageFrontsModal());
                    this.addEventListenerSafe('add-front-btn', 'click', () => this.addFront());
                    this.addEventListenerSafe('clear-period', 'click', () => this.clearCurrentPeriod());
                    this.addEventListenerSafe('export-period', 'click', () => this.exportCurrentPeriod());

                    // Front Configuration Actions
                    this.addEventListenerSafe('add-new-front-config', 'click', () => this.showNewFrontConfigModal());
                    this.addEventListenerSafe('import-config', 'click', () => this.importConfiguration());
                    this.addEventListenerSafe('export-config', 'click', () => this.exportConfiguration());

                    // Front Configuration Modal
                    this.addEventListenerSafe('close-config-modal', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('config-modal-backdrop', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('cancel-config', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('save-config', 'click', () => this.saveFrontConfiguration());
                    this.addEventListenerSafe('copy-default-potential', 'click', () => this.copyDefaultPotential());

                    // NEW: Reports Event Listeners
                    this.addEventListenerSafe('generate-all-reports', 'click', () => this.generateAllReports());
                    this.addEventListenerSafe('schedule-reports', 'click', () => this.scheduleReports());
                    this.addEventListenerSafe('export-reports-config', 'click', () => this.exportReportsConfig());
                    this.addEventListenerSafe('clear-reports-history', 'click', () => this.clearReportsHistory());

                    // Search
                    this.addEventListenerSafe('search-input', 'input', (e) => this.handleSearch(e));
                    this.addEventListenerSafe('table-search', 'input', (e) => this.handleTableSearch(e));

                    // New front input
                    this.addEventListenerSafe('new-front-input', 'keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.addFront();
                        }
                    });

                    // Navigation Links
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const page = link.dataset.page;
                            if (page) {
                                this.showPage(page);
                                if (window.innerWidth < 1024) {
                                    this.toggleSidebar(false);
                                }
                            }
                        });
                    });

                    // Setup Chart Controls
                    this.setupChartControls();

                    // NEW: Report Generation Buttons
                    document.querySelectorAll('.generate-report-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const reportType = btn.dataset.type;
                            this.generateReport(reportType);
                        });
                    });

                    // Global Events
                    document.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));
                    document.addEventListener('input', (e) => {
                        if (e.target.classList.contains('data-input')) {
                            this.handleInputChange(e);
                        }
                    });
                    window.addEventListener('resize', () => this.handleResize());
                    
                    // Mark as added
                    this.eventListenersAdded = true;
                    console.log('🎯 Event listeners configurados com sucesso');

                } catch (error) {
                    console.error('❌ Erro ao configurar event listeners:', error);
                    this.showToast('Erro ao configurar eventos do sistema', 'error');
                }
            }

            addEventListenerSafe(id, event, handler) {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(event, handler);
                    return true;
                } else {
                    console.warn(`⚠️ Element '${id}' not found for event '${event}'`);
                    return false;
                }
            }

            setupChartControls() {
                // Chart period buttons
                document.querySelectorAll('.chart-period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.switchChartPeriod(btn.dataset.period);
                    });
                });
            }

            initializeUI() {
                // Setup initial UI state
                this.updateFrontsList();
                this.generateTimePeriodButtons();
                this.updatePeriodContent();
                this.generateDashboardTable();
                this.generateFrontConfigCards();
                this.updateAllRealData();
                this.updateActiveEntriesCount();
                this.updateReportsLastGenerated(); // NEW
                
                console.log('🎨 Interface inicializada com dados reais + configurações + déficit + relatórios');
            }

            generateTimePeriodButtons() {
                const container = document.getElementById('time-periods-container');
                if (!container) return;

                container.innerHTML = this.timeSlots.map((slot, index) => `
                    <div class="time-period-card ${index === 0 ? 'active' : ''}" data-period="${slot.period}">
                        <div class="text-sm font-bold">${slot.start}-${slot.end}</div>
                        <div class="text-xs opacity-70 mt-1">${slot.label}</div>
                        <div class="text-xs mt-2">
                            <span class="font-medium" id="period-summary-${slot.period}">0t</span>
                        </div>
                    </div>
                `).join('');

                // Add click events
                container.querySelectorAll('.time-period-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const period = card.dataset.period;
                        if (period) {
                            this.switchTimePeriod(period);
                        }
                    });
                });

                // Update period summaries
                this.updatePeriodSummaries();
            }

            updatePeriodSummaries() {
                this.timeSlots.forEach(slot => {
                    const element = document.getElementById(`period-summary-${slot.period}`);
                    if (element) {
                        const periodData = this.state.data.periods[slot.period];
                        let totalDelivery = 0;
                        
                        this.state.fronts.forEach(front => {
                            if (periodData.fronts[front]) {
                                totalDelivery += periodData.fronts[front].total.delivery;
                            }
                        });
                        
                        element.textContent = `${totalDelivery.toFixed(1)}t`;
                    }
                });
            }

            generateFrontConfigCards() {
                const container = document.getElementById('fronts-config-grid');
                if (!container) return;

                container.innerHTML = this.state.fronts.map(front => {
                    const config = this.state.data.frontConfigs[front] || {};
                    const dailyGoal = parseFloat(config.dailyGoal) || 0;
                    const defaultPotential = parseFloat(config.defaultPotential) || 0;
                    
                    // Calculate total potential for this front (sum of hours with data only)
                    let totalUsedPotential = 0;
                    let totalConfiguredPotential = 0;
                    if (config.hourlyPotential) {
                        this.hours24.forEach(hour => {
                            totalConfiguredPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                        });
                        
                        // Calculate only potential for hours with actual data
                        this.timeSlots.forEach(slot => {
                            const frontData = this.state.data.periods[slot.period].fronts[front];
                            if (frontData && frontData.total.trips > 0) {
                                slot.hours.forEach(hour => {
                                    totalUsedPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                                });
                            }
                        });
                    }
                    
                    // Calculate current delivery for this front
                    let currentDelivery = 0;
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            currentDelivery += frontData.total.delivery;
                        }
                    });
                    
                    // NEW: Calculate missing delivery
                    const missingDelivery = Math.max(0, dailyGoal - currentDelivery);
                    
                    const goalProgress = dailyGoal > 0 ? (currentDelivery / dailyGoal) * 100 : 0;
                    const potentialProgress = totalUsedPotential > 0 ? (currentDelivery / totalUsedPotential) * 100 : 0;

                    return `
                        <div class="config-card rounded-2xl p-6 shadow-xl interactive">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-primary to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg">
                                        F
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Frente ${front}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Meta: ${dailyGoal.toFixed(0)}t - Usado: ${totalUsedPotential.toFixed(0)}t</p>
                                    </div>
                                </div>
                                <button class="config-front-btn p-2 text-gray-400 hover:text-primary transition-colors" data-front="${front}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                        <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Meta</div>
                                        <div class="text-lg font-bold text-blue-700 dark:text-blue-300">${dailyGoal.toFixed(0)}t</div>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                        <div class="text-sm text-green-600 dark:text-green-400 font-medium">Atual</div>
                                        <div class="text-lg font-bold text-green-700 dark:text-green-300">${currentDelivery.toFixed(1)}t</div>
                                    </div>
                                    <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-3">
                                        <div class="text-sm text-red-600 dark:text-red-400 font-medium">Faltante</div>
                                        <div class="text-lg font-bold text-red-700 dark:text-red-300">${missingDelivery.toFixed(1)}t</div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-600 dark:text-gray-400">Progresso vs Meta</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${goalProgress.toFixed(1)}%</span>
                                    </div>
                                    <div class="efficiency-bar h-2">
                                        <div class="efficiency-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: ${Math.min(goalProgress, 100)}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-600 dark:text-gray-400">Eficiência (só horas c/ dados)</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${potentialProgress.toFixed(1)}%</span>
                                    </div>
                                    <div class="efficiency-bar h-2">
                                        <div class="efficiency-fill bg-gradient-to-r from-purple-500 to-purple-600" style="width: ${Math.min(potentialProgress, 100)}%"></div>
                                    </div>
                                </div>

                                <div class="pt-2 border-t border-gray-200/50 dark:border-gray-700/50">
                                    <div class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
                                        <div>Padrão/hora: ${defaultPotential}t</div>
                                        <div>Pot. total: ${totalConfiguredPotential.toFixed(0)}t | Usado: ${totalUsedPotential.toFixed(0)}t</div>
                                        ${config.notes ? `<div>Obs: ${config.notes}</div>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add click listeners for configuration buttons
                container.querySelectorAll('.config-front-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const front = btn.dataset.front;
                        this.showFrontConfigModal(front);
                    });
                });
            }

            async initializeCharts() {
                if (!this.isChartsLibraryLoaded) {
                    console.warn('⚠️ Chart.js não disponível - pulando criação de gráficos');
                    return;
                }

                try {
                    await this.createPerformanceChart();
                    await this.createEfficiencyChart();
                    console.log('📈 Gráficos criados com sucesso - com cores dinâmicas');
                } catch (error) {
                    console.error('❌ Erro ao criar gráficos:', error);
                    this.showToast('Erro ao carregar gráficos', 'error');
                }
            }

            async createPerformanceChart() {
                const ctx = document.getElementById('performance-chart');
                if (!ctx) return;

                const isDark = document.documentElement.classList.contains('dark');
                
                // Get REAL data for chart using CORRECTED potential (only hours with data)
                const realData = this.getRealPerformanceData();
                
                this.charts.performance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.timeSlots.map(slot => slot.start),
                        datasets: [{
                            label: 'Entregue (t)',
                            data: realData.delivered,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#5D5CDE',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Potencial (só horas c/ dados)',
                            data: realData.potential,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: false,
                            borderDash: [8, 5],
                            borderWidth: 3,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter', weight: '500' },
                                    color: isDark ? '#E5E7EB' : '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}t`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280'
                                }
                            },
                            y: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(0) + 't';
                                    }
                                },
                                beginAtZero: true
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            // Get real performance data using only hours with actual data
            getRealPerformanceData() {
                const delivered = [];
                const potential = [];
                
                this.timeSlots.forEach(slot => {
                    let periodDelivered = 0;
                    let periodPotential = 0;
                    
                    this.state.fronts.forEach(front => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            periodDelivered += frontData.total.delivery;
                            
                            // Only add potential if there's actual data (trips > 0)
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        periodPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                } else {
                                    // Fallback to default
                                    periodPotential += this.state.config.defaultPotentialPerHour * 2;
                                }
                            }
                        }
                    });
                    
                    delivered.push(periodDelivered);
                    potential.push(periodPotential);
                });
                
                return { delivered, potential };
            }

            // FIXED: Efficiency chart with dynamic colors
            async createEfficiencyChart() {
                const ctx = document.getElementById('front-efficiency-chart');
                if (!ctx) return;

                // Get REAL efficiency data using CORRECTED potential (only hours with data)
                const realEfficiencyData = this.getRealEfficiencyData();

                // FIXED: Generate dynamic colors based on current number of fronts
                const dynamicColors = this.generateDynamicColors(this.state.fronts.length);

                const isDark = document.documentElement.classList.contains('dark');

                this.charts.efficiency = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: this.state.fronts.map(front => `F${front}`),
                        datasets: [{
                            data: realEfficiencyData.efficiencies,
                            backgroundColor: dynamicColors, // FIXED: Using dynamic colors
                            borderWidth: 4,
                            borderColor: isDark ? '#1F2937' : '#fff',
                            hoverBorderWidth: 6,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 24,
                                    usePointStyle: true,
                                    font: { family: 'Inter', size: 13, weight: '500' },
                                    color: isDark ? '#E5E7EB' : '#374151',
                                    generateLabels: (chart) => {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => ({
                                            text: `${label}: ${data.datasets[0].data[i].toFixed(1)}%`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].borderColor,
                                            lineWidth: data.datasets[0].borderWidth,
                                            pointStyle: 'circle',
                                            hidden: false,
                                            index: i
                                        }));
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed.toFixed(1)}%`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });

                console.log('🎨 Gráfico de eficiência criado com cores dinâmicas para', this.state.fronts.length, 'frentes');
            }

            // Get real efficiency data using only hours with actual data
            getRealEfficiencyData() {
                const efficiencies = [];
                
                this.state.fronts.forEach(front => {
                    let totalDelivery = 0;
                    let totalUsedPotential = 0;
                    
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            totalDelivery += frontData.total.delivery;
                            
                            // Only add potential if there's actual data (trips > 0)
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                } else {
                                    // Fallback
                                    totalUsedPotential += this.state.config.defaultPotentialPerHour * 2;
                                }
                            }
                        }
                    });
                    
                    const efficiency = totalUsedPotential > 0 ? (totalDelivery / totalUsedPotential) * 100 : 0;
                    efficiencies.push(Math.min(efficiency, 100));
                });
                
                return { efficiencies };
            }

            // FIXED: Update chart data with dynamic colors regeneration
            updateChartData() {
                // Update performance chart with CORRECTED data
                if (this.charts.performance) {
                    const realData = this.getRealPerformanceData();
                    this.charts.performance.data.datasets[0].data = realData.delivered;
                    this.charts.performance.data.datasets[1].data = realData.potential;
                    this.charts.performance.update('none');
                }

                // FIXED: Update efficiency chart with CORRECTED data and dynamic colors
                if (this.charts.efficiency) {
                    const realEfficiencyData = this.getRealEfficiencyData();
                    const dynamicColors = this.generateDynamicColors(this.state.fronts.length);
                    const isDark = document.documentElement.classList.contains('dark');
                    
                    // Update data and colors
                    this.charts.efficiency.data.labels = this.state.fronts.map(front => `F${front}`);
                    this.charts.efficiency.data.datasets[0].data = realEfficiencyData.efficiencies;
                    this.charts.efficiency.data.datasets[0].backgroundColor = dynamicColors; // FIXED: Update colors
                    this.charts.efficiency.data.datasets[0].borderColor = isDark ? '#1F2937' : '#fff'; // Update border color for dark mode
                    this.charts.efficiency.update('none');
                    
                    console.log('🎨 Gráfico de eficiência atualizado com cores dinâmicas para', this.state.fronts.length, 'frentes');
                }
            }

            startPeriodicUpdates() {
                // Auto-save
                setInterval(() => {
                    if (this.state.ui.unsavedChanges) {
                        this.saveData();
                    }
                }, this.state.config.autoSaveInterval);

                // Update real data periodically
                setInterval(() => {
                    this.updateAllRealData();
                    this.updateActiveEntriesCount();
                    this.updateNotificationCount();
                }, this.state.config.chartUpdateInterval);
                
                console.log('⏰ Atualizações periódicas configuradas');
            }

            // MAIN REAL DATA UPDATE FUNCTION with MISSING DELIVERY calculation
            updateAllRealData() {
                // Always ensure global goals are updated first
                this.updateGlobalGoals();
                
                this.updateDashboardStats();
                this.generateDashboardTable();
                this.updatePeriodSummaries();
                this.updateChartData();
                this.updateBestWorstPerformers();
                this.generateFrontConfigCards();
            }

            // UPDATE: Dashboard stats with MISSING DELIVERY calculation
            updateDashboardStats() {
                // Calculate REAL totals from all periods and fronts
                let totalDelivered = 0;
                let totalTrips = 0;
                let totalUsedPotential = 0;
                let allDensities = [];
                let totalActiveHours = 0;
                let periodsWithData = new Set();

                // Calculate total trucks per hour correctly
                this.state.fronts.forEach(front => {
                    let frontTotalDelivered = 0;
                    
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            frontTotalDelivered += frontData.total.delivery;
                            totalTrips += frontData.total.trips;
                            
                            if (frontData.total.density > 0) {
                                allDensities.push(frontData.total.density);
                            }
                            
                            // Only add potential and hours for actual data
                            if (frontData.total.trips > 0) {
                                periodsWithData.add(slot.period);
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    });
                    
                    totalDelivered += frontTotalDelivered;
                });

                // Calculate total active hours
                totalActiveHours = periodsWithData.size * 2;

                const avgEfficiency = totalUsedPotential > 0 ? (totalDelivered / totalUsedPotential) * 100 : 0;
                const avgDensity = allDensities.length > 0 
                    ? allDensities.reduce((a, b) => a + b, 0) / allDensities.length 
                    : 0;

                // Calculate TOTAL trucks per hour correctly
                const totalTrucksPerHour = totalActiveHours > 0 ? totalTrips / totalActiveHours : 0;

                // NEW: Calculate missing delivery
                const totalGoal = this.state.data.dailyGoals.delivery;
                const totalMissing = Math.max(0, totalUsedPotential - totalDelivered);

                // Update dashboard cards with MISSING DELIVERY
                this.updateElement('total-delivered', `${totalDelivered.toFixed(1)} t`);
                this.updateElement('total-missing', `${totalMissing.toFixed(1)} t`); // NEW
                this.updateElement('overall-efficiency', `${avgEfficiency.toFixed(1)}%`);
                this.updateElement('total-trips', totalTrips.toString());
                this.updateElement('total-potential', `${totalUsedPotential.toFixed(1)} t`);
                this.updateElement('avg-trucks-hour', `${totalTrucksPerHour.toFixed(1)}`);
                this.updateElement('active-periods-count', periodsWithData.size.toString());

                // Update header stats
                this.updateElement('header-total-delivered', Math.round(totalDelivered).toString());
                this.updateElement('header-missing', Math.round(totalMissing).toString()); // NEW
                this.updateElement('header-efficiency', Math.round(avgEfficiency).toString());
                this.updateElement('header-trucks-hour', Math.round(totalTrucksPerHour).toString());

                // Update progress bars and trends
                this.updateProgressAndTrends(totalDelivered, avgEfficiency, totalTrips, totalUsedPotential, totalTrucksPerHour, totalMissing);

                // Update efficiency circle
                const efficiencyCircle = document.getElementById('efficiency-circle');
                if (efficiencyCircle) {
                    efficiencyCircle.style.strokeDasharray = `${avgEfficiency}, 100`;
                }

                // Update potential usage
                const potentialUsage = totalUsedPotential > 0 ? (totalDelivered / totalUsedPotential) * 100 : 0;
                this.updateElement('potential-usage', `${potentialUsage.toFixed(1)}%`);
                this.updateProgressBar('potential-progress', potentialUsage);

                // Update trucks per hour progress
                const trucksPerHourTarget = 50;
                const trucksProgress = Math.min((totalTrucksPerHour / trucksPerHourTarget) * 100, 100);
                this.updateProgressBar('trucks-progress', trucksProgress);
            }

            updateProgressAndTrends(totalDelivered, avgEfficiency, totalTrips, totalUsedPotential, totalTrucksPerHour, totalMissing) {
                // Calculate progress against configured goals
                const totalGoalFromFronts = this.state.data.dailyGoals.delivery;
                const deliveryProgress = totalGoalFromFronts > 0 ? Math.min((totalDelivered / totalGoalFromFronts) * 100, 100) : 0;
                const tripsProgress = Math.min((totalTrips / this.state.data.dailyGoals.trips) * 100, 100);

                // NEW: Missing delivery progress
                const missingProgress = totalGoalFromFronts > 0 ? Math.min((totalMissing / totalGoalFromFronts) * 100, 100) : 0;

                this.updateProgressBar('delivery-progress', deliveryProgress);
                this.updateProgressBar('trips-progress', tripsProgress);
                this.updateProgressBar('missing-progress', missingProgress); // NEW

                this.updateElement('delivery-percentage', `${deliveryProgress.toFixed(1)}%`);
                this.updateElement('trips-percentage', `${tripsProgress.toFixed(1)}%`);
                this.updateElement('missing-percentage', `${missingProgress.toFixed(1)}%`); // NEW

                // Update trend indicators
                this.updateTrendIndicators(totalDelivered, avgEfficiency, totalTrips, totalUsedPotential, totalTrucksPerHour, totalMissing);
            }

            updateTrendIndicators(totalDelivered, avgEfficiency, totalTrips, totalUsedPotential, totalTrucksPerHour, totalMissing) {
                // Calculate trends vs configured goals/potential
                const totalGoal = this.state.data.dailyGoals.delivery;
                const deliveryTrend = totalGoal > 0 ? ((totalDelivered / totalGoal) - 1) * 100 : 0;
                const efficiencyTrend = avgEfficiency - this.state.data.dailyGoals.efficiency;
                const tripsTrend = ((totalTrips / this.state.data.dailyGoals.trips) - 1) * 100;
                const potentialTrend = totalUsedPotential > 0 ? ((totalDelivered / totalUsedPotential) - 0.85) * 100 : 0;

                // NEW: Missing delivery trend
                const missingTrend = totalGoal > 0 ? (totalMissing / totalGoal) * 100 : 0;

                this.updateTrendElement('delivery-trend', deliveryTrend);
                this.updateTrendElement('efficiency-trend', efficiencyTrend);
                this.updateTrendElement('trips-trend', tripsTrend);
                this.updateTrendElement('potential-trend', potentialTrend);
                this.updateTrendElement('missing-trend', missingTrend); // NEW

                // Update trucks per hour trend
                const trucksTarget = 50;
                const trucksTrend = ((totalTrucksPerHour / trucksTarget) - 1) * 100;
                this.updateTrendElement('trucks-trend', trucksTrend);

                // Update status indicators
                this.updateStatusElement('efficiency-status', avgEfficiency, this.state.data.dailyGoals.efficiency);
            }

            updateTrendElement(id, trend) {
                const element = document.getElementById(id);
                if (element) {
                    // Special handling for missing trend (inverted logic)
                    const isPositive = id === 'missing-trend' ? trend <= 0 : trend >= 0;
                    const color = isPositive ? 'text-success' : 'text-danger';
                    const symbol = isPositive ? '+' : '';
                    
                    element.className = `text-sm ${color} mr-2`;
                    
                    if (id === 'missing-trend') {
                        element.textContent = trend === 0 ? 'Meta atingida' : `${trend.toFixed(1)}% faltante`;
                    } else {
                        element.textContent = `${symbol}${trend.toFixed(1)}%`;
                    }
                }
            }

            updateStatusElement(id, current, target) {
                const element = document.getElementById(id);
                if (element) {
                    const ratio = current / target;
                    let status, color;
                    
                    if (ratio >= 0.95) {
                        status = 'Excelente';
                        color = 'text-success';
                    } else if (ratio >= 0.85) {
                        status = 'Bom';
                        color = 'text-primary';
                    } else if (ratio >= 0.70) {
                        status = 'Regular';
                        color = 'text-warning';
                    } else {
                        status = 'Atenção';
                        color = 'text-danger';
                    }
                    
                    element.className = `font-medium ${color}`;
                    element.textContent = status;
                }
            }

            // UPDATED: Generate dashboard table with MISSING DELIVERY column
            generateDashboardTable() {
                const tableBody = document.getElementById('performance-table');
                if (!tableBody) return;

                // Generate REAL data for each front with MISSING DELIVERY
                const tableData = this.state.fronts.map(front => {
                    let totalDelivery = 0;
                    let totalTrips = 0;
                    let totalUsedPotential = 0;
                    let weightedDensity = 0;
                    let totalTripWeights = 0;
                    let activeHours = 0;

                    // Sum data from all periods for this front
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            totalDelivery += frontData.total.delivery;
                            totalTrips += frontData.total.trips;
                            
                            if (frontData.total.trips > 0) {
                                weightedDensity += frontData.total.density * frontData.total.trips;
                                totalTripWeights += frontData.total.trips;
                                activeHours += 2;
                                
                                // Only add potential for hours with actual data
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    });

                    const efficiency = totalUsedPotential > 0 ? (totalDelivery / totalUsedPotential) * 100 : 0;
                    const avgDensity = totalTripWeights > 0 ? weightedDensity / totalTripWeights : 0;
                    const frontConfig = this.state.data.frontConfigs[front] || {};
                    const dailyGoal = parseFloat(frontConfig.dailyGoal) || 0;
                    
                    // Calculate trucks per hour for this individual front
                    const trucksPerHour = activeHours > 0 ? totalTrips / activeHours : 0;
                    
                    // NEW: Calculate missing delivery for this front
                    const missingDelivery = Math.max(0, dailyGoal - totalDelivery);

                    return {
                        front,
                        delivery: totalDelivery.toFixed(1),
                        missing: missingDelivery.toFixed(1), // NEW
                        potentialUsed: totalUsedPotential.toFixed(1),
                        dailyGoal: dailyGoal.toFixed(0),
                        efficiency: efficiency.toFixed(1),
                        trips: totalTrips,
                        trucksPerHour: trucksPerHour.toFixed(1),
                        density: avgDensity.toFixed(2),
                        status: this.getPerformanceStatus(efficiency),
                        statusColor: this.getPerformanceStatusColor(efficiency)
                    };
                });

                tableBody.innerHTML = tableData.map(row => `
                    <tr class="table-row hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-primary to-primary-600 rounded-xl flex items-center justify-center text-white text-sm font-bold mr-3 shadow-lg">F</div>
                                <span class="font-semibold text-gray-900 dark:text-white">${row.front}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-lg font-bold text-success">${row.delivery}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">toneladas</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-lg font-bold text-danger">${row.missing}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">faltante</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900 dark:text-gray-300">${row.potentialUsed}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">horas c/ dados</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-primary">${row.dailyGoal}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">meta diária</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="efficiency-bar w-20 mr-3">
                                    <div class="efficiency-fill bg-gradient-to-r from-green-500 to-green-600" style="width: ${Math.min(row.efficiency, 100)}%"></div>
                                </div>
                                <span class="text-sm font-bold text-gray-900 dark:text-white">${row.efficiency}%</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900 dark:text-gray-300">${row.trips}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">viagens</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-orange-600 dark:text-orange-400">${row.trucksPerHour}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">cam/hora</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-${row.statusColor}/10 text-${row.statusColor}">
                                <div class="w-2 h-2 rounded-full mr-2 bg-${row.statusColor}"></div>
                                ${row.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-2">
                                <button class="config-front-btn p-2 text-gray-400 hover:text-primary transition-colors tooltip" data-tooltip="Configurar frente" data-front="${row.front}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </button>
                                <button class="p-2 text-gray-400 hover:text-primary transition-colors tooltip" data-tooltip="Ver detalhes">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Add click listeners for config buttons
                tableBody.querySelectorAll('.config-front-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const front = btn.dataset.front;
                        this.showFrontConfigModal(front);
                    });
                });

                // Update table stats
                this.updateElement('table-showing', `1-${this.state.fronts.length}`);
                this.updateElement('table-total', this.state.fronts.length.toString());
            }

            getPerformanceStatus(efficiency) {
                if (efficiency >= 90) return 'Excelente';
                if (efficiency >= 80) return 'Bom';
                if (efficiency >= 70) return 'Regular';
                return 'Atenção';
            }

            getPerformanceStatusColor(efficiency) {
                if (efficiency >= 90) return 'success';
                if (efficiency >= 80) return 'primary';
                if (efficiency >= 70) return 'warning';
                return 'danger';
            }

            // Update best/worst performers using only hours with data
            updateBestWorstPerformers() {
                const performances = this.state.fronts.map(front => {
                    let totalDelivery = 0;
                    let totalUsedPotential = 0;

                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            totalDelivery += frontData.total.delivery;
                            
                            // Only count potential for hours with data
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    });

                    const efficiency = totalUsedPotential > 0 ? (totalDelivery / totalUsedPotential) * 100 : 0;
                    return { front, efficiency };
                });

                performances.sort((a, b) => b.efficiency - a.efficiency);
                
                const best = performances[0];
                const worst = performances[performances.length - 1];

                if (best && worst) {
                    this.updateElement('best-front', `F${best.front} - ${best.efficiency.toFixed(1)}%`);
                    this.updateElement('attention-front', `F${worst.front} - ${worst.efficiency.toFixed(1)}%`);
                }
            }

            updateNotificationCount() {
                let notificationCount = 0;
                
                // Count notifications based on efficiency and missing delivery
                this.state.fronts.forEach(front => {
                    let totalDelivered = 0;
                    let totalUsedPotential = 0;
                    let totalGoal = 0;

                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            totalDelivered += frontData.total.delivery;
                            
                            // Only count potential for hours with data
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    });
                    
                    const frontConfig = this.state.data.frontConfigs[front] || {};
                    totalGoal = parseFloat(frontConfig.dailyGoal) || 0;

                    const efficiency = totalUsedPotential > 0 ? (totalDelivered / totalUsedPotential) * 100 : 0;
                    const goalProgress = totalGoal > 0 ? (totalDelivered / totalGoal) * 100 : 0;
                    const missingDelivery = Math.max(0, totalGoal - totalDelivered);
                    
                    if (efficiency < 70 && efficiency > 0) {
                        notificationCount++;
                    }
                    if (goalProgress < 50 && totalGoal > 0) {
                        notificationCount++;
                    }
                    if (missingDelivery > totalGoal * 0.3) { // More than 30% missing
                        notificationCount++;
                    }
                });

                this.updateElement('notification-badge', notificationCount.toString());
            }

            // Navigation Methods
            toggleSidebar(force = null) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                if (!sidebar || !overlay) return;

                const shouldOpen = force !== null ? force : sidebar.classList.contains('-translate-x-full');
                
                if (shouldOpen) {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                    this.state.ui.sidebarOpen = true;
                    document.body.style.overflow = 'hidden';
                } else {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                    this.state.ui.sidebarOpen = false;
                    document.body.style.overflow = '';
                }
            }

            showPage(page) {
                // Update state
                this.state.currentPage = page;

                // Hide all pages
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Show selected page
                const pageContent = document.getElementById(`${page}-content`);
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                }

                // Update navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === page) {
                        link.classList.add('active');
                    }
                });

                // Page-specific initializations
                setTimeout(() => {
                    if (page === 'entrega-hora') {
                        this.updatePeriodContent();
                    } else if (page === 'frentes-config') {
                        this.generateFrontConfigCards();
                    } else if (page === 'relatorios') { // NEW
                        this.updateReportsLastGenerated();
                        this.updateRecentReportsList();
                    }
                    
                    // Update real data for any page
                    this.updateAllRealData();
                }, 300);

                console.log(`📄 Página alterada para: ${page}`);
            }

            toggleTheme() {
                const currentTheme = this.state.config.theme;
                
                if (currentTheme === 'auto') {
                    // Switch to light
                    this.state.config.theme = 'light';
                    document.documentElement.classList.remove('dark');
                } else if (currentTheme === 'light') {
                    // Switch to dark
                    this.state.config.theme = 'dark';
                    document.documentElement.classList.add('dark');
                } else {
                    // Switch to auto
                    this.state.config.theme = 'auto';
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (prefersDark) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
                
                this.updateThemeIcons();
                this.updateChartsTheme();
                this.saveData();
                this.showToast(`Tema alterado para ${this.state.config.theme}`, 'info');
            }

            updateChartsTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)';

                Object.values(this.charts).forEach(chart => {
                    if (chart && chart.options) {
                        // Update legend colors
                        if (chart.options.plugins?.legend?.labels) {
                            chart.options.plugins.legend.labels.color = textColor;
                        }
                        
                        // Update scale colors
                        if (chart.options.scales) {
                            ['x', 'y', 'y1', 'r'].forEach(axis => {
                                if (chart.options.scales[axis]) {
                                    if (chart.options.scales[axis].ticks) {
                                        chart.options.scales[axis].ticks.color = textColor;
                                    }
                                    if (chart.options.scales[axis].grid) {
                                        chart.options.scales[axis].grid.color = gridColor;
                                    }
                                }
                            });
                        }
                        
                        // Update efficiency chart border color for dark mode
                        if (chart.config.type === 'doughnut') {
                            chart.data.datasets[0].borderColor = isDark ? '#1F2937' : '#fff';
                        }
                        
                        chart.update('none');
                    }
                });
            }

            // Date Navigation with proper data loading/saving
            navigateDate(direction) {
                // Save current date data before changing
                this.saveData();
                
                const currentDate = new Date(this.state.currentDate);
                currentDate.setDate(currentDate.getDate() + direction);
                
                this.state.currentDate = currentDate.toISOString().split('T')[0];
                
                // Clear current periods data for new date
                this.timeSlots.forEach(slot => {
                    this.state.fronts.forEach(front => {
                        this.state.data.periods[slot.period].fronts[front] = {
                            hour1: { density: 0, trips: 0, delivery: 0 },
                            hour2: { density: 0, trips: 0, delivery: 0 },
                            total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                        };
                    });
                });
                
                // Load data for new date
                this.loadData();
                
                this.updateDateDisplay();
                this.showToast(`📅 Data: ${this.formatDate(this.state.currentDate)}`, 'info');
                
                // Update data for new date
                this.updateAllRealData();
                this.updatePeriodContent();
                
                console.log('📅 Data navegada para:', this.state.currentDate);
            }

            updateDateDisplay() {
                const dateText = document.getElementById('date-text');
                if (dateText) {
                    const today = new Date().toISOString().split('T')[0];
                    if (this.state.currentDate === today) {
                        dateText.textContent = 'Hoje';
                    } else {
                        dateText.textContent = this.formatDate(this.state.currentDate);
                    }
                }
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            // Date picker with proper data management
            showDatePicker() {
                const input = document.createElement('input');
                input.type = 'date';
                input.value = this.state.currentDate;
                input.style.position = 'absolute';
                input.style.opacity = '0';
                input.style.pointerEvents = 'none';
                
                document.body.appendChild(input);
                
                input.addEventListener('change', (e) => {
                    // Save current date data before changing
                    this.saveData();
                    
                    this.state.currentDate = e.target.value;
                    
                    // Clear current periods data for new date
                    this.timeSlots.forEach(slot => {
                        this.state.fronts.forEach(front => {
                            this.state.data.periods[slot.period].fronts[front] = {
                                hour1: { density: 0, trips: 0, delivery: 0 },
                                hour2: { density: 0, trips: 0, delivery: 0 },
                                total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                            };
                        });
                    });
                    
                    // Load data for new date
                    this.loadData();
                    
                    this.updateDateDisplay();
                    this.updateAllRealData();
                    this.updatePeriodContent();
                    document.body.removeChild(input);
                    this.showToast(`📅 Data alterada: ${this.formatDate(e.target.value)}`, 'success');
                    
                    console.log('📅 Data selecionada:', e.target.value);
                });
                
                input.click();
            }

            // Time Period Management
            switchTimePeriod(period) {
                this.state.activePeriod = period;

                // Update button states
                document.querySelectorAll('.time-period-card').forEach(card => {
                    card.classList.remove('active');
                    
                    if (card.dataset.period === period) {
                        card.classList.add('active');
                    }
                });

                this.updatePeriodContent();
                
                const timeSlot = this.timeSlots.find(slot => slot.period === period);
                if (timeSlot) {
                    this.showToast(`⏰ Período: ${timeSlot.start}-${timeSlot.end}`, 'info');
                }
            }

            updatePeriodContent() {
                const timeSlot = this.timeSlots.find(slot => slot.period === this.state.activePeriod);
                if (!timeSlot) return;

                // Update headers
                this.updateElement('period-title', `Período: ${timeSlot.start}-${timeSlot.end}`);
                this.updateElement('hour1-header', timeSlot.hours[0]);
                this.updateElement('hour2-header', timeSlot.hours[1]);
                this.updateElement('period-summary-title', `Resumo do Período ${timeSlot.start}-${timeSlot.end}`);

                // Generate table
                this.generatePeriodTable();
                this.updatePeriodSummary();
            }

            generatePeriodTable() {
                const tableBody = document.getElementById('period-data-table');
                if (!tableBody) return;

                const periodData = this.state.data.periods[this.state.activePeriod];
                
                tableBody.innerHTML = this.state.fronts.map(front => {
                    const frontData = periodData.fronts[front] || {
                        hour1: { density: 0, trips: 0, delivery: 0 },
                        hour2: { density: 0, trips: 0, delivery: 0 },
                        total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                    };

                    // Calculate potential for this period (only if there's data)
                    const timeSlot = this.timeSlots.find(slot => slot.period === this.state.activePeriod);
                    let configuredPotential = 0;
                    if (timeSlot && frontData.total.trips > 0) {
                        const frontConfig = this.state.data.frontConfigs[front];
                        if (frontConfig?.hourlyPotential) {
                            timeSlot.hours.forEach(hour => {
                                configuredPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                            });
                        }
                    }

                    const efficiency = configuredPotential > 0 ? (frontData.total.delivery / configuredPotential) * 100 : 0;

                    return `
                        <tr class="hover:bg-white/80 dark:hover:bg-gray-700/80 transition-all duration-300">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-gradient-to-br from-primary to-primary-600 rounded-lg flex items-center justify-center text-white text-xs font-bold mr-3">F</div>
                                    <div>
                                        <span class="font-semibold text-gray-900 dark:text-white">${front}</span>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">Pot: ${configuredPotential.toFixed(1)}t</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="space-y-2">
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" class="data-input w-full text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base" 
                                               placeholder="Densidade" 
                                               value="${frontData.hour1.density || ''}"
                                               data-front="${front}" 
                                               data-hour="hour1" 
                                               data-field="density"
                                               min="0" max="100" step="0.1">
                                        <input type="number" class="data-input w-full text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base" 
                                               placeholder="Viagens" 
                                               value="${frontData.hour1.trips || ''}"
                                               data-front="${front}" 
                                               data-hour="hour1" 
                                               data-field="trips"
                                               min="0" step="1">
                                    </div>
                                    <div class="text-sm font-bold text-success">Entrega: ${frontData.hour1.delivery.toFixed(1)}t</div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="space-y-2">
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" class="data-input w-full text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base" 
                                               placeholder="Densidade" 
                                               value="${frontData.hour2.density || ''}"
                                               data-front="${front}" 
                                               data-hour="hour2" 
                                               data-field="density"
                                               min="0" max="100" step="0.1">
                                        <input type="number" class="data-input w-full text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base" 
                                               placeholder="Viagens" 
                                               value="${frontData.hour2.trips || ''}"
                                               data-front="${front}" 
                                               data-hour="hour2" 
                                               data-field="trips"
                                               min="0" step="1">
                                    </div>
                                    <div class="text-sm font-bold text-success">Entrega: ${frontData.hour2.delivery.toFixed(1)}t</div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-lg font-bold text-success">${frontData.total.delivery.toFixed(1)}t</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">${frontData.total.trips} viagens</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center space-x-3">
                                    <div class="w-16 efficiency-bar">
                                        <div class="efficiency-fill bg-gradient-to-r from-green-500 to-green-600" style="width: ${Math.min(efficiency, 100)}%"></div>
                                    </div>
                                    <span class="font-bold text-gray-900 dark:text-white">${efficiency.toFixed(1)}%</span>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">vs ${configuredPotential.toFixed(1)}t</div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            updatePeriodSummary() {
                const periodData = this.state.data.periods[this.state.activePeriod];
                let totalDelivered = 0;
                let totalTrips = 0;
                let totalConfiguredPotential = 0;

                // Calculate potential for this period
                const timeSlot = this.timeSlots.find(slot => slot.period === this.state.activePeriod);
                
                this.state.fronts.forEach(front => {
                    const frontData = periodData.fronts[front];
                    if (frontData) {
                        totalDelivered += frontData.total.delivery;
                        totalTrips += frontData.total.trips;
                        
                        // Only add potential if there's data
                        if (frontData.total.trips > 0 && timeSlot) {
                            const frontConfig = this.state.data.frontConfigs[front];
                            if (frontConfig?.hourlyPotential) {
                                timeSlot.hours.forEach(hour => {
                                    totalConfiguredPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                });
                            }
                        }
                    }
                });

                const avgEfficiency = totalConfiguredPotential > 0 
                    ? (totalDelivered / totalConfiguredPotential) * 100 
                    : 0;

                // Update displays
                this.updateElement('summary-delivered', `${totalDelivered.toFixed(1)}t`);
                this.updateElement('summary-trips', totalTrips.toString());
                this.updateElement('summary-efficiency', `${avgEfficiency.toFixed(1)}%`);
                this.updateElement('summary-potential', `${totalConfiguredPotential.toFixed(1)}t`);
                this.updateElement('period-total-trips', totalTrips.toString());
                this.updateElement('period-total-delivery', `${totalDelivered.toFixed(1)}t`);
                this.updateElement('period-total-potential', `${totalConfiguredPotential.toFixed(1)}t`);
            }

            switchChartPeriod(period) {
                document.querySelectorAll('.chart-period-btn').forEach(btn => {
                    btn.classList.remove('active', 'bg-primary', 'text-white');
                    btn.classList.add('text-gray-600', 'dark:text-gray-400');
                    
                    if (btn.dataset.period === period) {
                        btn.classList.add('active', 'bg-primary', 'text-white');
                        btn.classList.remove('text-gray-600', 'dark:text-gray-400');
                    }
                });

                this.showToast(`📊 Gráfico: ${period}`, 'info');
            }

            // Search Functionality
            showSearch() {
                const modal = document.getElementById('search-modal');
                const input = document.getElementById('search-input');
                
                if (modal && input) {
                    modal.classList.remove('hidden');
                    this.state.ui.searchOpen = true;
                    document.body.style.overflow = 'hidden';
                    
                    setTimeout(() => {
                        input.focus();
                    }, 150);
                }
            }

            hideSearch() {
                const modal = document.getElementById('search-modal');
                const input = document.getElementById('search-input');
                
                if (modal && input) {
                    modal.classList.add('hidden');
                    this.state.ui.searchOpen = false;
                    input.value = '';
                    document.body.style.overflow = '';
                    this.clearSearchResults();
                }
            }

            handleSearch(e) {
                const query = e.target.value.toLowerCase().trim();
                const resultsContainer = document.getElementById('search-results');
                
                if (!resultsContainer) return;
                
                if (query.length < 2) {
                    this.clearSearchResults();
                    return;
                }
                
                const results = this.performSearch(query);
                this.displaySearchResults(results, resultsContainer);
            }

            performSearch(query) {
                const results = [];
                
                // Search in fronts
                this.state.fronts.forEach(front => {
                    if (front.toLowerCase().includes(query)) {
                        results.push({
                            type: 'front',
                            title: `Frente ${front}`,
                            description: 'Dados de produção, configuração e déficit + média TOTAL caminhões/hora',
                            action: () => {
                                this.showPage('entrega-hora');
                                this.hideSearch();
                            }
                        });
                    }
                });
                
                // Search in pages
                const pages = {
                    'dashboard': 'Dashboard Principal',
                    'entrega-hora': 'Entrega 24h',
                    'frentes-config': 'Configuração de Frentes',
                    'analytics': 'Analytics Avançado',
                    'metas': 'Metas e KPIs',
                    'historico': 'Histórico',
                    'relatorios': 'Relatórios Completos',
                    'backup': 'Backup & Sync',
                    'configuracoes': 'Configurações'
                };
                
                Object.entries(pages).forEach(([key, title]) => {
                    if (title.toLowerCase().includes(query) || key.toLowerCase().includes(query)) {
                        results.push({
                            type: 'page',
                            title,
                            description: 'Navegar para esta seção',
                            action: () => {
                                this.showPage(key);
                                this.hideSearch();
                            }
                        });
                    }
                });

                // Search for new features
                if (query.includes('déficit') || query.includes('deficit') || query.includes('faltante') || query.includes('não entregue')) {
                    results.push({
                        type: 'feature',
                        title: 'Análise de Déficit por Frente',
                        description: 'NOVO v8.0: Visualize quantas toneladas cada frente ficou sem entregar',
                        action: () => {
                            this.showPage('dashboard');
                            this.hideSearch();
                        }
                    });
                }

                if (query.includes('relatório') || query.includes('relatorio') || query.includes('report')) {
                    results.push({
                        type: 'feature',
                        title: 'Sistema Completo de Relatórios',
                        description: 'NOVO v8.0: Relatórios diários, semanais, mensais e customizados com exportação',
                        action: () => {
                            this.showPage('relatorios');
                            this.hideSearch();
                        }
                    });
                }

                if (query.includes('caminhões') || query.includes('caminhoes') || query.includes('hora') || query.includes('cam/h') || query.includes('total')) {
                    results.push({
                        type: 'feature',
                        title: 'Média TOTAL Caminhões por Hora CORRIGIDA',
                        description: 'Análise de produtividade total: soma de todas as viagens dividida pelas horas ativas',
                        action: () => {
                            this.showPage('dashboard');
                            this.hideSearch();
                        }
                    });
                }

                // Search for efficiency terms
                if (query.includes('eficiência') || query.includes('corrigida')) {
                    results.push({
                        type: 'feature',
                        title: 'Eficiência Corrigida',
                        description: 'Cálculo baseado apenas nas horas com dados reais',
                        action: () => {
                            this.showPage('dashboard');
                            this.hideSearch();
                        }
                    });
                }
                
                return results.slice(0, 10);
            }

            displaySearchResults(results, container) {
                if (results.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>Nenhum resultado encontrado</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = results.map(result => `
                    <div class="search-result p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-300">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-primary/20 rounded-lg flex items-center justify-center">
                                <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900 dark:text-white">${result.title}</h4>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${result.description}</p>
                            </div>
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </div>
                `).join('');
                
                // Add click listeners
                container.querySelectorAll('.search-result').forEach((el, index) => {
                    el.addEventListener('click', () => {
                        if (results[index]?.action) {
                            results[index].action();
                        }
                    });
                });
            }

            clearSearchResults() {
                const container = document.getElementById('search-results');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <p>Digite para pesquisar...</p>
                            <p class="text-xs mt-2">Use Ctrl+K para busca rápida</p>
                        </div>
                    `;
                }
            }

            handleTableSearch(e) {
                const query = e.target.value.toLowerCase().trim();
                const rows = document.querySelectorAll('#performance-table tr');
                
                rows.forEach(row => {
                    const frontText = row.textContent.toLowerCase();
                    row.style.display = frontText.includes(query) ? '' : 'none';
                });
            }

            // Front Management
            showManageFrontsModal() {
                const modal = document.getElementById('manage-fronts-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                    this.updateFrontsList();
                    
                    setTimeout(() => {
                        const input = document.getElementById('new-front-input');
                        if (input) input.focus();
                    }, 150);
                }
            }

            hideManageFrontsModal() {
                const modal = document.getElementById('manage-fronts-modal');
                const input = document.getElementById('new-front-input');
                
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                    
                    if (input) input.value = '';
                }
            }

            updateFrontsList() {
                const list = document.getElementById('fronts-list');
                if (!list) return;

                list.innerHTML = this.state.fronts.map(front => {
                    const config = this.state.data.frontConfigs[front] || {};
                    const dailyGoal = parseFloat(config.dailyGoal) || 0;
                    
                    return `
                        <li class="flex items-center justify-between p-4 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-primary to-primary-600 rounded-lg flex items-center justify-center text-white text-xs font-bold">F</div>
                                <div>
                                    <span class="font-semibold text-gray-900 dark:text-white">Frente ${front}</span>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        Meta: ${dailyGoal.toFixed(0)}t
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="config-front-btn p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors" data-front="${front}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </button>
                                <button class="remove-front-btn p-2 text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" data-front="${front}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    `;
                }).join('');
                
                // Add config listeners
                list.querySelectorAll('.config-front-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const front = btn.dataset.front;
                        this.showFrontConfigModal(front);
                    });
                });
                
                // Add remove listeners
                list.querySelectorAll('.remove-front-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const front = btn.dataset.front;
                        if (confirm(`Tem certeza que deseja remover a frente ${front}?`)) {
                            this.removeFront(front);
                        }
                    });
                });
            }

            // IMPROVED: Add front with proper chart update
            addFront() {
                const input = document.getElementById('new-front-input');
                if (!input) return;
                
                const frontNumber = input.value.trim();
                
                if (!frontNumber) {
                    this.showToast('Digite o número da frente', 'warning');
                    return;
                }
                
                if (!/^\d{4}$/.test(frontNumber)) {
                    this.showToast('Número da frente deve ter 4 dígitos', 'error');
                    return;
                }
                
                if (this.state.fronts.includes(frontNumber)) {
                    this.showToast('Esta frente já existe', 'warning');
                    return;
                }
                
                // Add front
                this.state.fronts.push(frontNumber);
                this.state.fronts.sort();
                
                // Initialize data for the new front in ALL periods
                this.timeSlots.forEach(slot => {
                    if (!this.state.data.periods[slot.period].fronts[frontNumber]) {
                        this.state.data.periods[slot.period].fronts[frontNumber] = {
                            hour1: { density: 0, trips: 0, delivery: 0 },
                            hour2: { density: 0, trips: 0, delivery: 0 },
                            total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                        };
                    }
                });
                
                // Initialize configuration for the new front
                this.state.data.frontConfigs[frontNumber] = {
                    dailyGoal: this.state.config.defaultFrontGoal,
                    defaultPotential: this.state.config.defaultPotentialPerHour,
                    hourlyPotential: {},
                    notes: ''
                };
                
                // Initialize hourly potential for all 24 hours
                this.hours24.forEach(hour => {
                    this.state.data.frontConfigs[frontNumber].hourlyPotential[hour] = this.state.config.defaultPotentialPerHour;
                });
                
                input.value = '';
                this.state.ui.unsavedChanges = true;
                
                this.showToast(`✅ Frente ${frontNumber} adicionada com configuração padrão e cores dinâmicas`, 'success');
                this.updateFrontsList();
                this.generateTimePeriodButtons();
                this.generateFrontConfigCards();
                this.updateGlobalGoals();
                this.updateAllRealData();
                this.updateActiveEntriesCount();
                
                // Update current period if on entrega-hora page
                if (this.state.currentPage === 'entrega-hora') {
                    this.updatePeriodContent();
                }
                
                // Save changes immediately
                this.saveData();
                
                console.log('🎨 Nova frente adicionada com cores dinâmicas - Total de frentes:', this.state.fronts.length);
            }

            // IMPROVED: Remove front with proper chart update
            removeFront(frontNumber) {
                if (this.state.fronts.length <= 1) {
                    this.showToast('Pelo menos uma frente deve permanecer', 'error');
                    return;
                }
                
                const index = this.state.fronts.indexOf(frontNumber);
                if (index > -1) {
                    // Remove from array
                    this.state.fronts.splice(index, 1);
                    
                    // Remove from data in ALL periods
                    this.timeSlots.forEach(slot => {
                        delete this.state.data.periods[slot.period].fronts[frontNumber];
                    });
                    
                    // Remove configuration
                    delete this.state.data.frontConfigs[frontNumber];
                    
                    this.state.ui.unsavedChanges = true;
                    
                    this.updateFrontsList();
                    this.generateTimePeriodButtons();
                    this.generateFrontConfigCards();
                    this.updateGlobalGoals();
                    this.updateAllRealData();
                    this.updateActiveEntriesCount();
                    this.showToast(`🗑️ Frente ${frontNumber} removida - cores atualizadas`, 'info');
                    
                    // Update current period if on entrega-hora page
                    if (this.state.currentPage === 'entrega-hora') {
                        this.updatePeriodContent();
                    }
                    
                    // Save changes immediately
                    this.saveData();
                    
                    console.log('🎨 Frente removida com cores dinâmicas atualizadas - Total de frentes:', this.state.fronts.length);
                }
            }

            refreshDashboard() {
                this.showToast('🔄 Atualizando dashboard com TODAS as melhorias v8.0...', 'info');
                
                // Show loading state
                const refreshBtn = document.getElementById('refresh-dashboard');
                if (refreshBtn) {
                    const icon = refreshBtn.querySelector('svg');
                    if (icon) icon.classList.add('animate-spin');
                }
                
                setTimeout(() => {
                    // Remove loading state
                    if (refreshBtn) {
                        const icon = refreshBtn.querySelector('svg');
                        if (icon) icon.classList.remove('animate-spin');
                    }
                    
                    this.updateAllRealData();
                    this.showToast('✅ Dashboard atualizado - APRIMORADO: Déficit + Relatórios Completos + Média TOTAL Cam/Hora v8.0', 'success');
                }, 1500);
            }

            exportDashboard() {
                this.showToast('📊 Função de exportação será implementada em breve', 'info');
            }

            exportTable() {
                this.showToast('📊 Função de exportação será implementada em breve', 'info');
            }

            clearCurrentPeriod() {
                const timeSlot = this.timeSlots.find(slot => slot.period === this.state.activePeriod);
                if (!timeSlot) return;

                if (confirm(`Tem certeza que deseja limpar todos os dados do período ${timeSlot.start}-${timeSlot.end}?`)) {
                    // Clear period data
                    this.state.fronts.forEach(front => {
                        const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                        if (frontData) {
                            frontData.hour1 = { density: 0, trips: 0, delivery: 0 };
                            frontData.hour2 = { density: 0, trips: 0, delivery: 0 };
                            frontData.total = { density: 0, trips: 0, delivery: 0, efficiency: 0 };
                        }
                    });
                    
                    this.state.ui.unsavedChanges = true;
                    this.updatePeriodContent();
                    this.updateAllRealData();
                    this.saveData();
                    this.showToast(`🧹 Período ${timeSlot.start}-${timeSlot.end} limpo`, 'success');
                }
            }

            exportCurrentPeriod() {
                this.showToast('📊 Função de exportação será implementada em breve', 'info');
            }

            // Data Input Handling - Corrected delivery calculation
            handleInputChange(e) {
                const front = e.target.dataset.front;
                const hour = e.target.dataset.hour;
                const field = e.target.dataset.field;
                const value = parseFloat(e.target.value) || 0;

                if (!front || !hour || !field) return;

                const periodData = this.state.data.periods[this.state.activePeriod];
                const frontData = periodData.fronts[front];

                if (!frontData) return;

                // Update the field
                frontData[hour][field] = value;

                // Calculate delivery for this hour using correct formula
                const density = frontData[hour].density || 0;
                const trips = frontData[hour].trips || 0;
                frontData[hour].delivery = density * trips; // Densidade × Viagens

                // Recalculate totals
                this.recalculateFrontTotals(front);

                // Update UI in real time
                this.updatePeriodSummary();
                this.updatePeriodSummaries();
                this.updateAllRealData();

                // Mark as having unsaved changes
                this.state.ui.unsavedChanges = true;

                // Apply visual feedback
                this.applyInputFeedback(e.target, value);
            }

            // Recalculate front totals with corrected efficiency calculation
            recalculateFrontTotals(front) {
                // Recalculate totals for this front across ALL periods
                this.timeSlots.forEach(slot => {
                    const frontData = this.state.data.periods[slot.period].fronts[front];
                    if (frontData) {
                        // Calculate totals for this period
                        frontData.total.density = frontData.hour1.density + frontData.hour2.density;
                        frontData.total.trips = frontData.hour1.trips + frontData.hour2.trips;
                        frontData.total.delivery = frontData.hour1.delivery + frontData.hour2.delivery;

                        // Calculate efficiency using configured potential only if there's data
                        let configuredPotential = 0;
                        if (frontData.total.trips > 0) {
                            const timeSlot = this.timeSlots.find(s => s.period === slot.period);
                            if (timeSlot) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    timeSlot.hours.forEach(hour => {
                                        configuredPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }

                        frontData.total.efficiency = configuredPotential > 0 
                            ? (frontData.total.delivery / configuredPotential) * 100 
                            : 0;
                    }
                });
            }

            applyInputFeedback(input, value) {
                // Remove existing classes
                input.classList.remove('input-success', 'input-warning', 'input-error');

                // Apply feedback based on value
                if (value > 0) {
                    if (value >= 50) { // Good value
                        input.classList.add('input-success');
                    } else if (value >= 20) { // OK value
                        input.classList.add('input-warning');
                    } else { // Low value
                        input.classList.add('input-error');
                    }
                }

                // Remove feedback after delay
                setTimeout(() => {
                    input.classList.remove('input-success', 'input-warning', 'input-error');
                }, 2000);
            }

            showQuickActions() {
                // Remove existing menu
                const existingMenu = document.querySelector('.quick-actions-menu');
                if (existingMenu) {
                    document.body.removeChild(existingMenu);
                    return;
                }

                const actions = [
                    { name: 'Salvar Dados', icon: '💾', action: () => this.saveData() },
                    { name: 'Atualizar Dashboard', icon: '🔄', action: () => this.refreshDashboard() },
                    { name: 'Configurar Frentes', icon: '⚙️', action: () => this.showPage('frentes-config') },
                    { name: 'Ver Déficit', icon: '⚠️', action: () => this.showPage('dashboard') },
                    { name: 'Gerar Relatórios', icon: '📊', action: () => this.showPage('relatorios') },
                    { name: 'Limpar Período', icon: '🧹', action: () => this.clearCurrentPeriod() },
                    { name: 'Gerenciar Frentes', icon: '🏭', action: () => this.showManageFrontsModal() },
                    { name: 'Buscar', icon: '🔍', action: () => this.showSearch() },
                    { name: 'Alternar Tema', icon: '🎨', action: () => this.toggleTheme() },
                    { name: 'Média TOTAL Cam/Hora', icon: '🚛', action: () => this.showToast('CORRIGIDO v8.0: Total de viagens ÷ horas ativas', 'info') },
                    { name: 'Salvamento por Data', icon: '📅', action: () => this.showToast('CORRIGIDO v8.0: Dados separados por data', 'info') },
                    { name: 'Eficiência Corrigida', icon: '📈', action: () => this.showToast('Ativo: cálculo só com horas que têm dados', 'info') },
                    { name: 'Cores Dinâmicas', icon: '🌈', action: () => this.showToast('Ativo: cores que se adaptam ao número de frentes', 'info') },
                    { name: 'Análise de Déficit', icon: '🔴', action: () => this.showToast('NOVO v8.0: Déficit por frente em tempo real', 'info') },
                    { name: 'Relatórios Completos', icon: '📋', action: () => this.showToast('NOVO v8.0: Sistema completo de relatórios', 'info') }
                ];
                
                const menu = document.createElement('div');
                menu.className = 'quick-actions-menu fixed bottom-20 right-6 glass rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/20 z-50 p-2 animate-slide-up max-h-96 overflow-y-auto';
                
                menu.innerHTML = actions.map(action => `
                    <button class="quick-action w-full flex items-center space-x-3 p-3 rounded-xl hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 text-left whitespace-nowrap">
                        <span class="text-lg">${action.icon}</span>
                        <span class="font-medium text-gray-900 dark:text-white">${action.name}</span>
                    </button>
                `).join('');
                
                document.body.appendChild(menu);
                
                // Add click listeners
                menu.querySelectorAll('.quick-action').forEach((btn, index) => {
                    btn.addEventListener('click', () => {
                        actions[index].action();
                        document.body.removeChild(menu);
                    });
                });
                
                // Auto close
                setTimeout(() => {
                    if (document.body.contains(menu)) {
                        menu.style.opacity = '0';
                        setTimeout(() => {
                            if (document.body.contains(menu)) {
                                document.body.removeChild(menu);
                            }
                        }, 300);
                    }
                }, 8000);

                // Close on outside click
                setTimeout(() => {
                    const closeHandler = (e) => {
                        if (!menu.contains(e.target) && !document.getElementById('floating-action').contains(e.target)) {
                            if (document.body.contains(menu)) {
                                document.body.removeChild(menu);
                            }
                            document.removeEventListener('click', closeHandler);
                        }
                    };
                    document.addEventListener('click', closeHandler);
                }, 100);
            }

            showNotifications() {
                this.showToast('🔔 Sistema de notificações será implementado em breve', 'info');
            }

            // Front Configuration Functions
            showNewFrontConfigModal() {
                this.showFrontConfigModal(); // Show modal without a specific front (new front mode)
            }

            showFrontConfigModal(frontNumber = null) {
                const modal = document.getElementById('front-config-modal');
                if (!modal) return;

                this.state.ui.currentConfigFront = frontNumber;
                
                // Update modal title
                const title = document.getElementById('config-modal-title');
                if (title) {
                    title.textContent = frontNumber ? `Configurar Frente ${frontNumber}` : 'Nova Frente';
                }

                // Load existing configuration if editing
                if (frontNumber) {
                    this.loadFrontConfigIntoModal(frontNumber);
                } else {
                    this.clearFrontConfigModal();
                }

                // Setup tabs
                this.setupConfigTabs();

                // Generate hourly potential grid
                this.generateHourlyPotentialGrid();

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                setTimeout(() => {
                    const firstInput = document.getElementById('front-daily-goal');
                    if (firstInput) firstInput.focus();
                }, 150);
            }

            setupConfigTabs() {
                const tabs = document.querySelectorAll('.tab-button');
                const contents = document.querySelectorAll('.tab-content');

                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const targetTab = tab.dataset.tab;
                        
                        // Update button states
                        tabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        // Update content visibility
                        contents.forEach(content => {
                            content.classList.add('hidden');
                        });
                        
                        const targetContent = document.getElementById(`${targetTab}-tab`);
                        if (targetContent) {
                            targetContent.classList.remove('hidden');
                        }

                        this.state.ui.activeConfigTab = targetTab;
                    });
                });
            }

            generateHourlyPotentialGrid() {
                const container = document.getElementById('hourly-potential-grid');
                if (!container) return;

                container.innerHTML = this.hours24.map(hour => `
                    <div class="flex flex-col">
                        <label class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">${hour}</label>
                        <input type="number" 
                               class="hourly-potential-input px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all text-base" 
                               placeholder="50" 
                               min="0" 
                               step="0.1"
                               data-hour="${hour}">
                    </div>
                `).join('');
            }

            loadFrontConfigIntoModal(frontNumber) {
                const config = this.state.data.frontConfigs[frontNumber] || {};
                
                // Load general config
                this.updateElement('front-daily-goal', config.dailyGoal || '');
                this.updateElement('front-default-potential', config.defaultPotential || '');
                this.updateElement('front-notes', config.notes || '');

                // Load hourly potentials
                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    const hour = input.dataset.hour;
                    if (config.hourlyPotential && config.hourlyPotential[hour] !== undefined) {
                        input.value = config.hourlyPotential[hour];
                    } else {
                        input.value = config.defaultPotential || '';
                    }
                });
            }

            clearFrontConfigModal() {
                // Clear all inputs
                ['front-daily-goal', 'front-default-potential', 'front-notes'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.value = '';
                });

                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    input.value = '';
                });
            }

            copyDefaultPotential() {
                const defaultPotential = document.getElementById('front-default-potential').value;
                if (!defaultPotential) {
                    this.showToast('Digite primeiro o potencial padrão', 'warning');
                    return;
                }

                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    input.value = defaultPotential;
                });

                this.showToast('Potencial padrão aplicado para todas as horas', 'success');
            }

            // Save front configuration
            saveFrontConfiguration() {
                const frontNumber = this.state.ui.currentConfigFront;
                const dailyGoal = parseFloat(document.getElementById('front-daily-goal').value) || 0;
                const defaultPotential = parseFloat(document.getElementById('front-default-potential').value) || 0;
                const notes = document.getElementById('front-notes').value || '';

                // If this is a new front, add it first
                if (!frontNumber) {
                    this.showToast('Função de nova frente será implementada', 'info');
                    this.hideFrontConfigModal();
                    return;
                }

                // Collect hourly potentials
                const hourlyPotential = {};
                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    const hour = input.dataset.hour;
                    const value = parseFloat(input.value) || 0;
                    hourlyPotential[hour] = value;
                });

                // Save configuration
                if (!this.state.data.frontConfigs[frontNumber]) {
                    this.state.data.frontConfigs[frontNumber] = {};
                }

                this.state.data.frontConfigs[frontNumber] = {
                    dailyGoal,
                    defaultPotential,
                    hourlyPotential,
                    notes
                };

                this.state.ui.unsavedChanges = true;
                this.hideFrontConfigModal();
                this.showToast(`✅ Configuração da frente ${frontNumber} salva`, 'success');

                // Update global goals and refresh all UI
                this.updateGlobalGoals();
                this.updateAllRealData();
                this.generateFrontConfigCards();
                
                // Save immediately to persist the changes
                this.saveData();
            }

            hideFrontConfigModal() {
                const modal = document.getElementById('front-config-modal');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                    this.state.ui.currentConfigFront = null;
                }
            }

            importConfiguration() {
                this.showToast('📥 Função de importação será implementada em breve', 'info');
            }

            exportConfiguration() {
                this.showToast('📤 Função de exportação será implementada em breve', 'info');
            }

            // NEW: Reports System Functions
            generateAllReports() {
                this.showLoadingOverlay('Gerando todos os relatórios...');
                
                setTimeout(() => {
                    const reportTypes = ['daily', 'weekly', 'monthly', 'performance', 'efficiency'];
                    reportTypes.forEach(type => {
                        this.generateReport(type, false); // Don't show individual toasts
                    });
                    
                    this.hideLoadingOverlay();
                    this.showToast('✅ Todos os relatórios foram gerados com sucesso!', 'success');
                    this.updateRecentReportsList();
                }, 2000);
            }

            generateReport(type, showToast = true) {
                if (showToast) {
                    this.showLoadingOverlay(`Gerando relatório ${this.state.reports.templates[type].name}...`);
                }

                // Simulate report generation
                setTimeout(() => {
                    const reportData = this.prepareReportData(type);
                    const report = {
                        id: Date.now() + Math.random(),
                        type,
                        name: this.state.reports.templates[type].name,
                        format: this.state.reports.templates[type].format,
                        generatedAt: new Date().toISOString(),
                        date: this.state.currentDate,
                        data: reportData,
                        size: this.calculateReportSize(reportData)
                    };

                    // Add to history
                    this.state.reports.history.unshift(report);
                    this.state.reports.lastGenerated[type] = new Date().toISOString();

                    // Keep only last 50 reports
                    if (this.state.reports.history.length > 50) {
                        this.state.reports.history = this.state.reports.history.slice(0, 50);
                    }

                    this.saveData();

                    if (showToast) {
                        this.hideLoadingOverlay();
                        this.showToast(`📊 ${report.name} gerado com sucesso!`, 'success');
                        this.updateReportsLastGenerated();
                        this.updateRecentReportsList();
                    }

                    console.log(`📊 Relatório ${type} gerado:`, report);
                }, showToast ? 1500 : 500);
            }

            prepareReportData(type) {
                const currentData = {
                    date: this.state.currentDate,
                    fronts: this.state.fronts,
                    periods: this.state.data.periods,
                    configs: this.state.data.frontConfigs,
                    goals: this.state.data.dailyGoals
                };

                let reportData = {};

                switch (type) {
                    case 'daily':
                        reportData = this.prepareDailyReportData(currentData);
                        break;
                    case 'weekly':
                        reportData = this.prepareWeeklyReportData(currentData);
                        break;
                    case 'monthly':
                        reportData = this.prepareMonthlyReportData(currentData);
                        break;
                    case 'performance':
                        reportData = this.preparePerformanceReportData(currentData);
                        break;
                    case 'efficiency':
                        reportData = this.prepareEfficiencyReportData(currentData);
                        break;
                    case 'custom':
                        reportData = this.prepareCustomReportData(currentData);
                        break;
                    default:
                        reportData = currentData;
                }

                return reportData;
            }

            prepareDailyReportData(currentData) {
                // Calculate daily summary
                let totalDelivered = 0;
                let totalTrips = 0;
                let totalUsedPotential = 0;
                let totalGoal = 0;
                let frontDetails = [];

                this.state.fronts.forEach(front => {
                    let frontDelivered = 0;
                    let frontTrips = 0;
                    let frontUsedPotential = 0;
                    let frontActiveHours = 0;

                    this.timeSlots.forEach(slot => {
                        const frontData = currentData.periods[slot.period].fronts[front];
                        if (frontData && frontData.total.trips > 0) {
                            frontDelivered += frontData.total.delivery;
                            frontTrips += frontData.total.trips;
                            frontActiveHours += 2;

                            const frontConfig = currentData.configs[front];
                            if (frontConfig?.hourlyPotential) {
                                slot.hours.forEach(hour => {
                                    frontUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                });
                            }
                        }
                    });

                    const frontConfig = currentData.configs[front] || {};
                    const frontGoal = parseFloat(frontConfig.dailyGoal) || 0;
                    const frontMissing = Math.max(0, frontGoal - frontDelivered);
                    const frontEfficiency = frontUsedPotential > 0 ? (frontDelivered / frontUsedPotential) * 100 : 0;
                    const frontTrucksPerHour = frontActiveHours > 0 ? frontTrips / frontActiveHours : 0;

                    frontDetails.push({
                        front,
                        delivered: frontDelivered,
                        missing: frontMissing,
                        goal: frontGoal,
                        trips: frontTrips,
                        efficiency: frontEfficiency,
                        trucksPerHour: frontTrucksPerHour,
                        activeHours: frontActiveHours
                    });

                    totalDelivered += frontDelivered;
                    totalTrips += frontTrips;
                    totalUsedPotential += frontUsedPotential;
                    totalGoal += frontGoal;
                });

                const totalMissing = Math.max(0, totalUsedPotential - totalDelivered);
                const overallEfficiency = totalUsedPotential > 0 ? (totalDelivered / totalUsedPotential) * 100 : 0;

                return {
                    summary: {
                        date: currentData.date,
                        totalDelivered,
                        totalMissing,
                        totalGoal,
                        totalTrips,
                        overallEfficiency,
                        goalAchievement: totalGoal > 0 ? (totalDelivered / totalGoal) * 100 : 0
                    },
                    fronts: frontDetails,
                    periods: this.timeSlots.map(slot => {
                        let periodDelivered = 0;
                        let periodTrips = 0;
                        
                        this.state.fronts.forEach(front => {
                            const frontData = currentData.periods[slot.period].fronts[front];
                            if (frontData) {
                                periodDelivered += frontData.total.delivery;
                                periodTrips += frontData.total.trips;
                            }
                        });

                        return {
                            period: slot.period,
                            start: slot.start,
                            end: slot.end,
                            delivered: periodDelivered,
                            trips: periodTrips
                        };
                    })
                };
            }

            prepareWeeklyReportData(currentData) {
                // For now, return current day data with weekly context
                return {
                    period: '7 dias',
                    startDate: this.getDateDaysAgo(7),
                    endDate: currentData.date,
                    dailyData: this.prepareDailyReportData(currentData),
                    trends: {
                        deliveryTrend: 'Em desenvolvimento',
                        efficiencyTrend: 'Em desenvolvimento'
                    }
                };
            }

            prepareMonthlyReportData(currentData) {
                return {
                    period: '30 dias',
                    startDate: this.getDateDaysAgo(30),
                    endDate: currentData.date,
                    dailyData: this.prepareDailyReportData(currentData),
                    kpis: {
                        averageDaily: 'Em desenvolvimento',
                        bestDay: 'Em desenvolvimento',
                        worstDay: 'Em desenvolvimento'
                    }
                };
            }

            preparePerformanceReportData(currentData) {
                const dailyData = this.prepareDailyReportData(currentData);
                const rankedFronts = dailyData.fronts.sort((a, b) => b.efficiency - a.efficiency);

                return {
                    date: currentData.date,
                    ranking: rankedFronts,
                    bestPerformer: rankedFronts[0],
                    worstPerformer: rankedFronts[rankedFronts.length - 1],
                    benchmarks: {
                        avgEfficiency: rankedFronts.reduce((sum, f) => sum + f.efficiency, 0) / rankedFronts.length,
                        totalDeficit: rankedFronts.reduce((sum, f) => sum + f.missing, 0)
                    }
                };
            }

            prepareEfficiencyReportData(currentData) {
                const dailyData = this.prepareDailyReportData(currentData);
                const frontsWithDeficit = dailyData.fronts.filter(f => f.missing > 0);

                return {
                    date: currentData.date,
                    totalDeficit: dailyData.summary.totalMissing,
                    frontsWithDeficit,
                    deficitByPeriod: dailyData.periods.map(period => ({
                        ...period,
                        potentialLoss: 'Calculado com base no período'
                    })),
                    recommendations: [
                        'Focar nas frentes com maior déficit',
                        'Otimizar períodos de baixa produtividade',
                        'Revisar metas baseadas no histórico'
                    ]
                };
            }

            prepareCustomReportData(currentData) {
                return {
                    type: 'custom',
                    data: currentData,
                    note: 'Relatório customizado - configuração em desenvolvimento'
                };
            }

            calculateReportSize(data) {
                // Estimate report size based on data complexity
                const jsonSize = JSON.stringify(data).length;
                if (jsonSize < 10000) return 'Pequeno (~100KB)';
                if (jsonSize < 50000) return 'Médio (~500KB)';
                return 'Grande (~1MB)';
            }

            getDateDaysAgo(days) {
                const date = new Date(this.state.currentDate);
                date.setDate(date.getDate() - days);
                return date.toISOString().split('T')[0];
            }

            scheduleReports() {
                this.showToast('📅 Função de agendamento será implementada em breve', 'info');
            }

            exportReportsConfig() {
                this.showToast('⚙️ Função de configuração será implementada em breve', 'info');
            }

            clearReportsHistory() {
                if (confirm('Tem certeza que deseja limpar todo o histórico de relatórios?')) {
                    this.state.reports.history = [];
                    this.state.reports.lastGenerated = {};
                    this.saveData();
                    this.updateRecentReportsList();
                    this.updateReportsLastGenerated();
                    this.showToast('🗑️ Histórico de relatórios limpo', 'success');
                }
            }

            updateReportsLastGenerated() {
                Object.keys(this.state.reports.templates).forEach(type => {
                    const element = document.getElementById(`${type}-last-gen`);
                    if (element) {
                        const lastGen = this.state.reports.lastGenerated[type];
                        if (lastGen) {
                            const date = new Date(lastGen);
                            element.textContent = date.toLocaleString('pt-BR');
                        } else {
                            element.textContent = 'Nunca';
                        }
                    }
                });
            }

            updateRecentReportsList() {
                const container = document.getElementById('recent-reports-list');
                if (!container) return;

                if (this.state.reports.history.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>Nenhum relatório gerado ainda</p>
                            <p class="text-xs mt-2">Gere seu primeiro relatório usando os cartões acima</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.state.reports.history.slice(0, 10).map(report => {
                    const date = new Date(report.generatedAt);
                    const typeColors = {
                        daily: 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400',
                        weekly: 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400',
                        monthly: 'bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400',
                        performance: 'bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400',
                        efficiency: 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400',
                        custom: 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400'
                    };

                    return `
                        <div class="flex items-center justify-between p-4 glass rounded-lg hover:bg-white/50 dark:hover:bg-gray-700/50 transition-colors">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-primary to-primary-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-900 dark:text-white">${report.name}</h4>
                                    <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                                        <span>${date.toLocaleString('pt-BR')}</span>
                                        <span>•</span>
                                        <span>${report.format}</span>
                                        <span>•</span>
                                        <span>${report.size}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[report.type] || typeColors.custom}">
                                    ${report.type.toUpperCase()}
                                </span>
                                <button class="download-report-btn p-2 text-gray-400 hover:text-primary transition-colors" data-report-id="${report.id}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add download listeners
                container.querySelectorAll('.download-report-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const reportId = btn.dataset.reportId;
                        this.downloadReport(reportId);
                    });
                });
            }

            downloadReport(reportId) {
                const report = this.state.reports.history.find(r => r.id == reportId);
                if (!report) {
                    this.showToast('Relatório não encontrado', 'error');
                    return;
                }

                // Create downloadable content
                const reportContent = {
                    metadata: {
                        name: report.name,
                        type: report.type,
                        format: report.format,
                        generatedAt: report.generatedAt,
                        date: report.date,
                        version: this.version
                    },
                    data: report.data
                };

                const dataStr = JSON.stringify(reportContent, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);

                const link = document.createElement('a');
                link.href = url;
                link.download = `${report.name.replace(/\s+/g, '_')}_${report.date}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                this.showToast(`📥 ${report.name} baixado com sucesso`, 'success');
            }

            showLoadingOverlay(message) {
                const overlay = document.getElementById('loading-overlay');
                const messageEl = document.getElementById('loading-message');
                
                if (overlay && messageEl) {
                    messageEl.textContent = message;
                    overlay.classList.remove('hidden');
                }
            }

            hideLoadingOverlay() {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                }
            }

            // Helper Functions
            updateProgressBar(id, percentage) {
                const bar = document.getElementById(id);
                if (bar) {
                    bar.style.width = `${Math.min(percentage, 100)}%`;
                }
            }

            updateActiveEntriesCount() {
                this.updateElement('active-entries-count', this.state.fronts.length.toString());
            }

            handleKeyboardShortcuts(e) {
                // Ctrl/Cmd + S: Save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    this.saveData();
                }
                
                // Ctrl/Cmd + K: Search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    this.showSearch();
                }
                
                // Ctrl/Cmd + D: Toggle theme
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    this.toggleTheme();
                }
                
                // Ctrl/Cmd + R: Generate reports
                if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                    e.preventDefault();
                    this.showPage('relatorios');
                }
                
                // Escape: Close modals
                if (e.key === 'Escape') {
                    if (this.state.ui.searchOpen) {
                        this.hideSearch();
                    }
                    
                    const modals = [
                        'manage-fronts-modal',
                        'front-config-modal'
                    ];
                    
                    modals.forEach(modalId => {
                        const modal = document.getElementById(modalId);
                        if (modal && !modal.classList.contains('hidden')) {
                            modal.classList.add('hidden');
                            document.body.style.overflow = '';
                        }
                    });
                }
                
                // Alt + Arrow keys: Navigate dates
                if (e.altKey && e.key === 'ArrowLeft') {
                    e.preventDefault();
                    this.navigateDate(-1);
                }
                if (e.altKey && e.key === 'ArrowRight') {
                    e.preventDefault();
                    this.navigateDate(1);
                }

                // F5: Refresh current page
                if (e.key === 'F5') {
                    e.preventDefault();
                    this.refreshDashboard();
                }
            }

            handleResize() {
                // Redraw charts
                Object.values(this.charts).forEach(chart => {
                    if (chart?.resize) {
                        chart.resize();
                    }
                });
                
                // Close sidebar on desktop
                if (window.innerWidth >= 1024 && this.state.ui.sidebarOpen) {
                    this.toggleSidebar(false);
                }
            }

            showToast(message, type = 'info', duration = 4000) {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                const colors = {
                    success: 'bg-green-500 border-green-600',
                    error: 'bg-red-500 border-red-600',
                    warning: 'bg-yellow-500 border-yellow-600',
                    info: 'bg-blue-500 border-blue-600'
                };

                const icons = {
                    success: '✅',
                    error: '❌',
                    warning: '⚠️',
                    info: 'ℹ️'
                };

                toast.className = `${colors[type]} text-white p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 border-l-4 flex items-center space-x-3 mb-3`;
                toast.innerHTML = `
                    <span class="text-lg">${icons[type]}</span>
                    <span class="flex-1 text-sm font-medium">${message}</span>
                    <button class="text-white/80 hover:text-white transition-colors toast-close">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                `;

                // Add close functionality
                const closeBtn = toast.querySelector('.toast-close');
                closeBtn.addEventListener('click', () => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (container.contains(toast)) {
                            container.removeChild(toast);
                        }
                    }, 300);
                });

                container.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                }, 100);

                // Auto remove
                setTimeout(() => {
                    if (container.contains(toast)) {
                        toast.classList.add('translate-x-full');
                        setTimeout(() => {
                            if (container.contains(toast)) {
                                container.removeChild(toast);
                            }
                        }, 300);
                    }
                }, duration);
            }

            updateElement(id, text) {
                const element = document.getElementById(id);
                if (element) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.value = text;
                    } else {
                        element.textContent = text;
                    }
                }
            }

            hideLoader() {
                const loader = document.getElementById('app-loader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Apply theme immediately
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            // Create global app instance
            window.ggomesApp = new GGomesLogSystemEnhanced();
            
            console.log('🚀 GGOMES-LOG v8.0 inicializado - APRIMORADO: Déficit + Relatórios Completos + Média TOTAL Caminhões/Hora + Salvamento por Data');
        });
    </script>
</body>
</html>
